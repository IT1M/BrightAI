const firebaseConfig={apiKey:"your-api-key-here",authDomain:"mais-co-hr-portal.firebaseapp.com",projectId:"mais-co-hr-portal",storageBucket:"mais-co-hr-portal.appspot.com",messagingSenderId:"123456789012",appId:"1:123456789012:web:abcdef123456789012345678",measurementId:"G-XXXXXXXXXX"};if(typeof firebase<"u")try{firebase.initializeApp(firebaseConfig);const db=firebase.firestore();firebase.analytics&&firebase.analytics(),console.log("Firebase initialized successfully"),window.firebaseDb=db,window.firebaseAuth=firebase.auth()}catch(error){console.error("Firebase initialization error:",error)}else console.warn("Firebase SDK not loaded. Using localStorage as fallback.");const FirebaseHelper={async saveApplication(applicationData){try{if(window.firebaseDb)return(await window.firebaseDb.collection("applications").add({...applicationData,timestamp:firebase.firestore.FieldValue.serverTimestamp(),status:"pending"})).id;{const applications=JSON.parse(localStorage.getItem("submittedApplications")||"[]"),newApplication={...applicationData,id:Date.now().toString(),timestamp:new Date().toISOString(),status:"pending"};return applications.push(newApplication),localStorage.setItem("submittedApplications",JSON.stringify(applications)),newApplication.id}}catch(error){throw console.error("Error saving application:",error),error}},async getApplications(){try{return window.firebaseDb?(await window.firebaseDb.collection("applications").orderBy("timestamp","desc").get()).docs.map(doc=>({id:doc.id,...doc.data()})):JSON.parse(localStorage.getItem("submittedApplications")||"[]")}catch(error){return console.error("Error fetching applications:",error),JSON.parse(localStorage.getItem("submittedApplications")||"[]")}},async updateApplication(applicationId,updates){try{if(window.firebaseDb)await window.firebaseDb.collection("applications").doc(applicationId).update({...updates,lastModified:firebase.firestore.FieldValue.serverTimestamp()});else{const applications=JSON.parse(localStorage.getItem("submittedApplications")||"[]"),index=applications.findIndex(app=>app.id===applicationId);index!==-1&&(applications[index]={...applications[index],...updates,lastModified:new Date().toISOString()},localStorage.setItem("submittedApplications",JSON.stringify(applications)))}}catch(error){throw console.error("Error updating application:",error),error}},async saveJob(jobData){try{if(window.firebaseDb)return(await window.firebaseDb.collection("jobs").add({...jobData,createdAt:firebase.firestore.FieldValue.serverTimestamp(),status:"active"})).id;{const jobs=JSON.parse(localStorage.getItem("jobVacancies")||"[]"),newJob={...jobData,id:Date.now().toString(),createdAt:new Date().toISOString(),status:"active"};return jobs.push(newJob),localStorage.setItem("jobVacancies",JSON.stringify(jobs)),newJob.id}}catch(error){throw console.error("Error saving job:",error),error}},async getJobs(){try{return window.firebaseDb?(await window.firebaseDb.collection("jobs").where("status","==","active").orderBy("createdAt","desc").get()).docs.map(doc=>({id:doc.id,...doc.data()})):JSON.parse(localStorage.getItem("jobVacancies")||"[]")}catch(error){return console.error("Error fetching jobs:",error),JSON.parse(localStorage.getItem("jobVacancies")||"[]")}},async saveAdvancedAnalysis(applicationId,analysisData){try{if(window.firebaseDb)await window.firebaseDb.collection("advanced_analysis").doc(applicationId).set({applicationId,analysis:analysisData,timestamp:firebase.firestore.FieldValue.serverTimestamp()});else{const analyses=JSON.parse(localStorage.getItem("advancedAnalyses")||"{}");analyses[applicationId]={applicationId,analysis:analysisData,timestamp:new Date().toISOString()},localStorage.setItem("advancedAnalyses",JSON.stringify(analyses))}}catch(error){throw console.error("Error saving advanced analysis:",error),error}},async getAdvancedAnalysis(applicationId){try{if(window.firebaseDb){const doc=await window.firebaseDb.collection("advanced_analysis").doc(applicationId).get();return doc.exists?doc.data():null}else return JSON.parse(localStorage.getItem("advancedAnalyses")||"{}")[applicationId]||null}catch(error){return console.error("Error fetching advanced analysis:",error),null}},async saveSystemStats(statsData){try{if(window.firebaseDb)await window.firebaseDb.collection("system_stats").add({...statsData,timestamp:firebase.firestore.FieldValue.serverTimestamp()});else{const stats=JSON.parse(localStorage.getItem("systemStats")||"[]");stats.push({...statsData,timestamp:new Date().toISOString()}),stats.length>100&&stats.splice(0,stats.length-100),localStorage.setItem("systemStats",JSON.stringify(stats))}}catch(error){console.error("Error saving system stats:",error)}},async logUserActivity(userId,action,details={}){try{const activityData={userId,action,details,timestamp:window.firebaseDb?firebase.firestore.FieldValue.serverTimestamp():new Date().toISOString(),userAgent:navigator.userAgent,ip:"client-side"};if(window.firebaseDb)await window.firebaseDb.collection("user_activities").add(activityData);else{const activities=JSON.parse(localStorage.getItem("userActivities")||"[]");activities.push(activityData),activities.length>50&&activities.splice(0,activities.length-50),localStorage.setItem("userActivities",JSON.stringify(activities))}}catch(error){console.error("Error logging user activity:",error)}}};window.FirebaseHelper=FirebaseHelper,document.addEventListener("DOMContentLoaded",function(){typeof firebase<"u"&&(console.log("Firebase services ready"),FirebaseHelper.saveSystemStats({event:"system_startup",userAgent:navigator.userAgent,timestamp:new Date().toISOString()}).catch(err=>console.warn("Could not save startup stats:",err)))}),window.firebaseConfig=firebaseConfig;
