<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bright AI | النظام الطبي الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background: #050505;
            color: #ffffff;
            overflow: hidden;
        }

        /* تأثيرات الخلفية */
        .animated-bg {
            position: fixed;
            inset: 0;
            z-index: -2;
            background: radial-gradient(circle at 50% 50%, #1a103c 0%, #000000 100%);
        }

        .grid-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            background-image: linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-strong {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .glass-hover:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        /* Chat Animation */
        .chat-bubble {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #a78bfa;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* Active States */
        .nav-item.active {
            background: rgba(139, 92, 246, 0.15);
            color: #fff;
            border-right: 3px solid #8b5cf6;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #7c3aed, #4f46e5);
            border-color: transparent;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 40, 0.9);
            border: 1px solid #333;
            padding: 10px 20px;
            border-radius: 50px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
    </style>
    <link rel="stylesheet" href="../../../frontend/css/bundle-main.css" />
    <script src="../../../frontend/js/navigation.js" defer></script>
</head>

<body class="h-screen flex text-sm">


    <!-- UNIFIED HEADER (REBUILT) -->
    <nav class="unified-nav" role="navigation" aria-label="التنقل الرئيسي">
        <div class="nav-container">

            <!-- Mobile Toggle -->
            <button class="mobile-toggle" aria-label="فتح القائمة" aria-expanded="false">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>

            <!-- Logo -->
            <a href="../../../" class="nav-logo" aria-label="Bright AI - الصفحة الرئيسية">
                <img src="../../../frontend/assets/images/Gemini.png" alt="Bright AI Logo" width="40" height="40" />
                <span>Bright AI</span>
            </a>

            <!-- Desktop Navigation -->
            <ul class="nav-links">
                <li class="nav-item">
                    <a href="../../../" class="nav-link">
                        الرئيسية
                    </a>
                </li>

                <!-- Products & Services -->
                <li class="nav-item">
                    <a href="#" class="nav-link" aria-haspopup="true" aria-expanded="false">
                        المنتجات والخدمات
                        <iconify-icon icon="lucide:chevron-down" width="14" class="chevron-down"></iconify-icon>
                    </a>
                    <div class="dropdown-menu">
                        <a href="../../../frontend/pages/smart-automation" class="dropdown-item">
                            <iconify-icon icon="lucide:zap"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">الأتمتة الذكية</span>
                                <span class="dropdown-desc">تحسين كفاءة العمليات التشغيلية</span>
                            </div>
                        </a>
                        <a href="../../../frontend/pages/our-products" class="dropdown-item">
              <iconify-icon icon="lucide:package"></iconify-icon>
              <div class="dropdown-item-content">
                <span class="dropdown-title">المنتجات والاشتراكات</span>
                <span class="dropdown-desc">استكشف منتجاتنا وخطط الاشتراك</span>
              </div>
            </a>
                        <a href="../../../frontend/pages/data-analysis" class="dropdown-item">
                            <iconify-icon icon="lucide:bar-chart-2"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">تحليل البيانات</span>
                                <span class="dropdown-desc">رؤى دقيقة لاتخاذ القرارات</span>
                            </div>
                        </a>
                        <a href="../../../frontend/pages/consultation" class="dropdown-item">
                            <iconify-icon icon="lucide:message-square"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">استشارات تقنية</span>
                                <span class="dropdown-desc">خبراء في استراتيجيات AI</span>
                            </div>
                        </a>
                    </div>
                </li>

                <!-- Solutions & Experience Models -->
                <li class="nav-item">
                    <a href="#" class="nav-link" aria-haspopup="true" aria-expanded="false">
                        الحلول و نماذج التجربة
                        <iconify-icon icon="lucide:chevron-down" width="14" class="chevron-down"></iconify-icon>
                    </a>
                    <div class="dropdown-menu">
            <a href="../../../frontend/pages/ai-agent" class="dropdown-item">
              <iconify-icon icon="lucide:bot"></iconify-icon>
              <div class="dropdown-item-content">
                <span class="dropdown-title">AI (AIaaS) للمنشآت</span>
                <span class="dropdown-desc">حلول AIaaS المرنة</span>
              </div>
            </a>
                        <a href="../../../frontend/pages/try" class="dropdown-item">
                            <iconify-icon icon="lucide:database"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">ذكاء البيانات</span>
                                <span class="dropdown-desc">منصة معالجة البيانات المتقدمة</span>
                            </div>
                        </a>
                        <a href="../../../frontend/pages/tools" class="dropdown-item">
                            <iconify-icon icon="lucide:wrench"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">أدوات مجانية</span>
                                <span class="dropdown-desc">جرب تقنياتنا مجاناً</span>
                            </div>
                        </a>
                        <a href="../../../frontend/pages/smart-medical-archive/" class="dropdown-item">
                            <iconify-icon icon="lucide:heart-pulse"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">الأرشيف الطبي الذكي</span>
                                <span class="dropdown-desc">للقطاع الصحي والمستشفيات</span>
                            </div>
                        </a>
                        <a href="../../../frontend/pages/interview/" class="dropdown-item">
                            <iconify-icon icon="lucide:users"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">التوظيف الذكي</span>
                                <span class="dropdown-desc">أتمتة عمليات الموارد البشرية</span>
                            </div>
                        </a>
                    </div>
                </li>

                <!-- Company -->
                <li class="nav-item">
                    <a href="#" class="nav-link" aria-haspopup="true" aria-expanded="false">
                        الشركة
                        <iconify-icon icon="lucide:chevron-down" width="14" class="chevron-down"></iconify-icon>
                    </a>
                    <div class="dropdown-menu">
                        <a href="../../../frontend/pages/about-us" class="dropdown-item">
                            <iconify-icon icon="lucide:info"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">من نحن</span>
                                <span class="dropdown-desc">تعرف على رؤيتنا وفريقنا</span>
                            </div>
                        </a>
                        <a href="../../../frontend/pages/blog" class="dropdown-item">
                            <iconify-icon icon="lucide:book-open"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">المكتبة الذكية</span>
                                <span class="dropdown-desc">مقالات وأخبار التقنية</span>
                            </div>
                        </a>
                        <a href="../../../Docs" class="dropdown-item">
                            <iconify-icon icon="lucide:file-text"></iconify-icon>
                            <div class="dropdown-item-content">
                                <span class="dropdown-title">المستندات</span>
                                <span class="dropdown-desc">التوثيق التقني والأدلة</span>
                            </div>
                        </a>
                    </div>
                </li>
            </ul>

            <!-- CTA Button -->
            <div class="hidden lg:block">
                <a href="https://wa.me/966538229013" class="nav-btn">
                    اتصل بنا
                </a>
            </div>

        </div>
    </nav>

    <!-- Mobile Menu Drawer -->
    <div class="mobile-menu-drawer">
        <ul class="mobile-nav-list">
            <li><a href="../../../" class="mobile-nav-link">الرئيسية</a></li>

            <li>
                <a href="#" class="mobile-nav-link" aria-haspopup="true" aria-expanded="false">
                    المنتجات والخدمات
                    <iconify-icon icon="lucide:chevron-down"></iconify-icon>
                </a>
                <div class="mobile-dropdown">
                    <a href="../../../frontend/pages/smart-automation" class="dropdown-item">الأتمتة الذكية</a>
                    <a href="../../../frontend/pages/our-products" class="dropdown-item">المنتجات والاشتراكات</a>
                    <a href="../../../frontend/pages/data-analysis" class="dropdown-item">تحليل البيانات</a>
                    <a href="../../../frontend/pages/consultation" class="dropdown-item">استشارات تقنية</a>
                </div>
            </li>

            <li>
                <a href="#" class="mobile-nav-link" aria-haspopup="true" aria-expanded="false">
                    الحلول و نماذج التجربة
                    <iconify-icon icon="lucide:chevron-down"></iconify-icon>
                </a>
                <div class="mobile-dropdown">
          <a href="../../../frontend/pages/ai-agent" class="dropdown-item">AI (AIaaS) للمنشآت</a>
                    <a href="../../../frontend/pages/try" class="dropdown-item">ذكاء البيانات</a>
                    <a href="../../../frontend/pages/tools" class="dropdown-item">أدوات مجانية</a>
                    <a href="../../../frontend/pages/smart-medical-archive/" class="dropdown-item">الأرشيف
                        الطبي الذكي</a>
                    <a href="../../../frontend/pages/interview/" class="dropdown-item">التوظيف الذكي</a>
                </div>
            </li>

            <li>
                <a href="#" class="mobile-nav-link" aria-haspopup="true" aria-expanded="false">
                    الشركة
                    <iconify-icon icon="lucide:chevron-down"></iconify-icon>
                </a>
                <div class="mobile-dropdown">
                    <a href="../../../frontend/pages/about-us" class="dropdown-item">من نحن</a>
                    <a href="../../../frontend/pages/blog" class="dropdown-item">المكتبة الذكية</a>
                    <a href="../../../Docs" class="dropdown-item">المستندات</a>
                </div>
            </li>

            <li>
                <a href="https://wa.me/966538229013" class="mobile-nav-link" style="color: var(--accent-color);">
                    اتصل بنا
                </a>
            </li>
        </ul>
    </div>

    <!-- Backdrop -->
    <div class="backdrop-overlay"></div>



    <div class="animated-bg"></div>
    <div class="grid-overlay"></div>

    <!-- Sidebar -->
    <aside class="w-64 glass-strong border-l border-white/5 flex flex-col justify-between z-20 hidden md:flex">
        <div>
            <div class="h-16 flex items-center px-6 border-b border-white/5">
                <div class="flex items-center gap-3">
                    <div
                        class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center font-bold shadow-lg">
                        AI</div>
                    <div>
                        <div class="font-bold text-base">Bright AI</div>
                        <div class="text-[10px] text-white/40">Medical Archive</div>
                    </div>
                </div>
            </div>
            <nav class="p-3 space-y-1 mt-4">
                <a href="/"
                    class="nav-item flex items-center gap-3 px-3 py-2.5 text-white/60 hover:text-white rounded-lg transition-colors"
                    onclick="setActive(this)">
                    <iconify-icon icon="solar:widget-linear" width="20"></iconify-icon> <span>لوحة التحكم</span>
                </a>
                <a href="NLP-Search"
                    class="nav-item active flex items-center gap-3 px-3 py-2.5 text-white hover:text-white rounded-lg transition-colors"
                    onclick="setActive(this)">
                    <iconify-icon icon="solar:magnifer-linear" width="20"></iconify-icon> <span>البحث المتقدم
                        (NLP)</span>
                </a>
                <a href="Ingestion"
                    class="nav-item flex items-center gap-3 px-3 py-2.5 text-white/60 hover:text-white rounded-lg transition-colors"
                    onclick="setActive(this)">
                    <iconify-icon icon="solar:document-add-linear" width="20"></iconify-icon> <span>الإدخال
                        والمعالجة</span>
                </a>
                <a href="EHR-Viewer"
                    class="nav-item flex items-center gap-3 px-3 py-2.5 text-white/60 hover:text-white rounded-lg transition-colors"
                    onclick="setActive(this)">
                    <iconify-icon icon="solar:user-id-linear" width="20"></iconify-icon> <span>سجلات المرضى</span>
                </a>
                <a href="Analytics&Insights"
                    class="nav-item flex items-center gap-3 px-3 py-2.5 text-white/60 hover:text-white rounded-lg transition-colors"
                    onclick="setActive(this)">
                    <iconify-icon icon="solar:chart-2-linear" width="22"></iconify-icon> <span>التحليلات والرؤى</span>
                </a>
            </nav>
        </div>
        <div class="p-4 border-t border-white/5">
            <div class="flex items-center gap-3 px-2">
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-tr from-emerald-500 to-teal-500 flex items-center justify-center font-bold text-xs">
                    د.م</div>
                <div>
                    <div class="text-xs font-medium">د. محمد القحطاني</div>
                    <div class="text-[10px] text-emerald-400">Admin Access</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full relative z-10 min-w-0">
        <!-- Header -->
        <header class="h-16 glass border-b border-white/5 flex items-center justify-between px-6 shrink-0">
            <div class="flex items-center gap-3">
                <h1 class="font-medium text-white/90">محرك البحث الدلالي</h1>
                <span id="connectionStatus"
                    class="px-2 py-0.5 rounded-full bg-purple-500/10 border border-purple-500/20 text-[10px] text-purple-400 flex items-center gap-1 transition-all">
                    <span class="w-1.5 h-1.5 rounded-full bg-purple-500 animate-pulse"></span>
                    API Connected
                </span>
            </div>
            <div class="flex items-center gap-3">
                <button
                    class="w-8 h-8 rounded-lg glass-hover flex items-center justify-center text-white/60"><iconify-icon
                        icon="solar:bell-linear"></iconify-icon></button>
                <button
                    class="w-8 h-8 rounded-lg glass-hover flex items-center justify-center text-white/60"><iconify-icon
                        icon="solar:settings-linear"></iconify-icon></button>
            </div>
        </header>

        <!-- Workspace -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Left Panel: Filters -->
            <div class="w-72 glass border-l border-white/5 p-5 overflow-y-auto hidden lg:block">
                <div class="flex items-center gap-2 mb-6 text-purple-300">
                    <iconify-icon icon="solar:filter-linear"></iconify-icon> <span class="font-semibold">فلاتر
                        البحث</span>
                </div>
                <!-- Time Range -->
                <div class="mb-6">
                    <label class="text-[11px] text-white/40 mb-2 block uppercase tracking-wider">النطاق الزمني</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button
                            class="filter-btn active px-3 py-2 rounded-lg text-xs bg-white/5 border border-white/10 hover:bg-white/10 transition-all"
                            onclick="toggleFilter(this)">آخر 7 أيام</button>
                        <button
                            class="filter-btn px-3 py-2 rounded-lg text-xs bg-white/5 border border-white/10 hover:bg-white/10 transition-all"
                            onclick="toggleFilter(this)">آخر شهر</button>
                        <button
                            class="filter-btn px-3 py-2 rounded-lg text-xs bg-white/5 border border-white/10 hover:bg-white/10 transition-all"
                            onclick="toggleFilter(this)">آخر 6 أشهر</button>
                        <button
                            class="filter-btn px-3 py-2 rounded-lg text-xs bg-white/5 border border-white/10 hover:bg-white/10 transition-all"
                            onclick="toggleFilter(this)">آخر سنة</button>
                    </div>
                </div>
                <!-- Doc Type -->
                <div class="mb-6">
                    <label class="text-[11px] text-white/40 mb-2 block uppercase tracking-wider">نوع الوثيقة</label>
                    <div class="space-y-1">
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer group">
                            <input type="checkbox" checked
                                class="accent-purple-500 w-4 h-4 bg-transparent border-white/20">
                            <span class="text-white/70 group-hover:text-white">تحاليل مختبر</span>
                            <span class="mr-auto text-[10px] text-white/20">2.8k</span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer group">
                            <input type="checkbox" class="accent-purple-500 w-4 h-4 bg-transparent border-white/20">
                            <span class="text-white/70 group-hover:text-white">تقارير أشعة</span>
                            <span class="mr-auto text-[10px] text-white/20">1.2k</span>
                        </label>
                    </div>
                </div>
                <!-- Department -->
                <div class="mb-6">
                    <label class="text-[11px] text-white/40 mb-2 block uppercase tracking-wider">القسم الطبي</label>
                    <div class="relative">
                        <select
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2.5 text-white/80 outline-none focus:border-purple-500 appearance-none">
                            <option class="bg-black">الباطنة العامة</option>
                            <option class="bg-black">القلب والأوعية</option>
                            <option class="bg-black">الأورام</option>
                        </select>
                        <iconify-icon icon="solar:alt-arrow-down-linear"
                            class="absolute left-3 top-3 text-white/40 pointer-events-none"></iconify-icon>
                    </div>
                </div>
                <button onclick="resetChat()"
                    class="w-full py-2.5 rounded-lg border border-dashed border-white/20 text-white/40 hover:text-white hover:border-white/40 hover:bg-white/5 transition-all flex items-center justify-center gap-2">
                    <iconify-icon icon="solar:restart-linear"></iconify-icon> بدء محادثة جديدة
                </button>
            </div>

            <!-- Center: Chat -->
            <div class="flex-1 flex flex-col relative bg-black/20">
                <div id="chatContainer" class="flex-1 overflow-y-auto p-6 space-y-6 scroll-smooth pb-32">
                    <!-- Welcome State -->
                    <div id="welcomeState"
                        class="h-full flex flex-col items-center justify-center text-center max-w-2xl mx-auto">
                        <div
                            class="w-20 h-20 rounded-2xl bg-gradient-to-br from-purple-600/20 to-blue-600/20 border border-purple-500/30 flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(139,92,246,0.2)]">
                            <iconify-icon icon="solar:magic-stick-3-bold-duotone" width="40"
                                class="text-white"></iconify-icon>
                        </div>
                        <h2
                            class="text-2xl font-bold mb-3 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">
                            كيف يمكنني مساعدتك اليوم؟</h2>
                        <p class="text-white/40 mb-8 max-w-md">نظام الأرشفة الذكي جاهز لتحليل السجلات الطبية واستخراج
                            البيانات المعقدة.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full">
                            <button onclick="fillQuery('مرضى السكري فوق 50 سنة الذين تناولوا ميتفورمين')"
                                class="text-right p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-purple-500/30 transition-all group">
                                <div class="flex items-start gap-3">
                                    <iconify-icon icon="solar:user-plus-linear"
                                        class="text-purple-400 mt-1"></iconify-icon>
                                    <div>
                                        <div class="font-medium text-white/90 group-hover:text-white">تحليل مرضى السكري
                                        </div>
                                        <div class="text-xs text-white/40 mt-1">فوق 50 سنة + ميتفورمين</div>
                                    </div>
                                </div>
                            </button>
                            <button onclick="fillQuery('نتائج تحاليل الدم الشاذة (High WBC) في قسم الطوارئ')"
                                class="text-right p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-blue-500/30 transition-all group">
                                <div class="flex items-start gap-3">
                                    <iconify-icon icon="solar:danger-triangle-linear"
                                        class="text-blue-400 mt-1"></iconify-icon>
                                    <div>
                                        <div class="font-medium text-white/90 group-hover:text-white">حالات الطوارئ
                                            الحرجة</div>
                                        <div class="text-xs text-white/40 mt-1">ارتفاع كريات الدم البيضاء</div>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Input -->
                <div
                    class="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-black via-black/90 to-transparent">
                    <div class="max-w-4xl mx-auto relative">
                        <div
                            class="glass-strong rounded-2xl p-2 border border-purple-500/30 flex items-end gap-2 shadow-2xl">
                            <textarea id="userInput" rows="1"
                                class="flex-1 bg-transparent border-none text-white px-4 py-3 outline-none resize-none placeholder:text-white/30 max-h-32"
                                placeholder="اكتب استعلامك الطبي هنا..."></textarea>
                            <div class="flex items-center pb-1 pr-2">
                                <button id="sendBtn"
                                    class="p-3 rounded-xl bg-gradient-to-br from-purple-600 to-blue-600 text-white hover:opacity-90 transition-opacity flex items-center justify-center shadow-lg">
                                    <iconify-icon icon="solar:arrow-left-linear" width="20"></iconify-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Context -->
            <div class="w-80 glass border-r border-white/5 p-6 overflow-y-auto hidden xl:block" id="contextPanel">
                <div class="flex items-center gap-2 mb-6">
                    <iconify-icon icon="solar:layers-minimalistic-bold-duotone" class="text-blue-400"
                        width="20"></iconify-icon>
                    <span class="font-semibold text-white">سياق البحث (Live NER)</span>
                </div>
                <div id="nerContainer" class="space-y-4 transition-all duration-500">
                    <!-- Placeholder -->
                    <div class="text-center py-10 opacity-50">
                        <div class="w-16 h-16 mx-auto bg-white/5 rounded-full flex items-center justify-center mb-3">
                            <iconify-icon icon="solar:cpu-linear" class="text-white/20" width="32"></iconify-icon>
                        </div>
                        <p class="text-xs text-white/30">بانتظار المدخلات...</p>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t border-white/10">
                    <h4 class="text-[11px] uppercase tracking-wider text-white/40 mb-3">علاقات المعرفة</h4>
                    <div class="flex flex-wrap gap-2" id="tagsContainer"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // --- API Config ---
        const API_KEY = "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";
        const API_URL = "https://api.groq.com/openai/v1/chat/completions";

        let messageHistory = [{
            role: "system",
            content: `You are Bright AI, a medical archive assistant. Answer in Arabic. 
            Extract entities at the end in JSON format separated by |||. 
            Format: Text response... ||| {"intent": "search", "disease": [], "medication": [], "demographics": ""}`
        }];

        // --- Elements ---
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const nerContainer = document.getElementById('nerContainer');
        const statusBadge = document.getElementById('connectionStatus');
        const sendBtn = document.getElementById('sendBtn');

        // --- Event Listeners ---
        if (userInput) {
            userInput.addEventListener('input', function () { this.style.height = 'auto'; this.style.height = (this.scrollHeight) + 'px'; });
            userInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } });
        }

        if (sendBtn) {
            sendBtn.addEventListener('click', handleSend);
        }

        // --- Main Functions ---
        async function handleSend() {
            const text = userInput.value.trim();
            if (!text) return;

            // UI Reset
            document.getElementById('welcomeState').style.display = 'none';
            userInput.value = '';
            userInput.style.height = 'auto';

            addBubble(text, 'user');
            const loadingId = addLoadingBubble();

            messageHistory.push({ role: "user", content: text });

            try {
                // محاولة الاتصال بالخادم
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${API_KEY}` },
                    body: JSON.stringify({ model: "llama3-70b-8192", messages: messageHistory, temperature: 0.3 })
                });

                if (!response.ok) throw new Error("API Error");

                const data = await response.json();
                const content = data.choices[0].message.content;
                processResponse(content, loadingId);

                // Update Status to Green
                updateStatus(true);

            } catch (error) {
                console.warn("API Failed, switching to Mock Mode:", error);

                // Fallback to Mock System if API fails
                updateStatus(false);
                showToast("تنبيه: فشل الاتصال بالخادم. يتم استخدام نظام المحاكاة (Demo Mode).");

                setTimeout(() => {
                    const mockResponse = generateMockResponse(text);
                    processResponse(mockResponse, loadingId);
                }, 1500);
            }
        }

        function processResponse(fullContent, loadingId) {
            document.getElementById(loadingId).remove();

            const parts = fullContent.split('|||');
            const aiText = parts[0].trim();
            const jsonPart = parts.length > 1 ? parts[1].trim() : null;

            addBubble(aiText, 'ai');
            messageHistory.push({ role: "assistant", content: fullContent });

            if (jsonPart) {
                try { updateNER(JSON.parse(jsonPart)); } catch (e) { }
            }
        }

        // --- Mock System (Smart Fallback) ---
        function generateMockResponse(text) {
            // محاكاة ذكية بناءً على الكلمات المفتاحية
            let response = "بناءً على البحث في الأرشيف، ";
            let json = { intent: "search", disease: [], medication: [], related_concepts: ["سجل طبي", "تحليل"] };

            if (text.includes("سكري") || text.includes("Diabetes")) {
                response += "وجدت 1,240 سجلاً لمرضى السكري. تظهر البيانات ارتفاعاً في الحالات فوق سن الخمسين.";
                json.disease = ["السكري (Type 2)"];
                json.medication = ["Metformin", "Insulin"];
                json.demographics = "العمر > 50";
                json.related_concepts = ["HbA1c", "ضغط الدم"];
            } else if (text.includes("طوارئ") || text.includes("دم")) {
                response += "تم رصد 45 حالة حرجة في قسم الطوارئ مرتبطة بارتفاع كريات الدم البيضاء (Leukocytosis) خلال الـ 24 ساعة الماضية.";
                json.disease = ["عدوى محتملة", "Leukocytosis"];
                json.demographics = "قسم الطوارئ";
                json.related_concepts = ["CBC Test", "CRP"];
            } else {
                response += "قمت بتحليل الطلب واستخراج السجلات ذات الصلة. هل ترغب في تصفية النتائج حسب التاريخ؟";
                json.related_concepts = ["بحث عام"];
            }

            return `${response} ||| ${JSON.stringify(json)}`;
        }

        // --- UI Helpers ---
        function addBubble(text, type) {
            const div = document.createElement('div');
            div.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'} chat-bubble`;
            const formattedText = type === 'ai' ? text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>') : text;

            div.innerHTML = `
                <div class="max-w-2xl flex gap-3 ${type === 'user' ? 'flex-row-reverse' : ''}">
                    ${type === 'ai' ? '<div class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-600 to-blue-600 flex-shrink-0 flex items-center justify-center text-xs shadow-lg mt-1">AI</div>' : ''}
                    <div class="${type === 'ai' ? 'glass text-white/90' : 'bg-white/10 text-white'} px-5 py-3.5 rounded-2xl ${type === 'ai' ? 'rounded-tl-none' : 'rounded-tr-none'} border border-white/5 text-sm leading-relaxed">
                        ${formattedText}
                    </div>
                </div>`;
            chatContainer.appendChild(div);
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addLoadingBubble() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex justify-start chat-bubble';
            div.innerHTML = `
                <div class="max-w-2xl flex gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-600 to-blue-600 flex-shrink-0 flex items-center justify-center text-xs shadow-lg mt-1">AI</div>
                    <div class="glass px-5 py-4 rounded-2xl rounded-tl-none border border-white/5 flex gap-1">
                        <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
                    </div>
                </div>`;
            chatContainer.appendChild(div);
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
            return id;
        }

        function updateNER(data) {
            let html = '';
            if (data.disease?.length) html += createEntityBlock('التشخيص', data.disease, 'text-red-300', 'bg-red-500/10', 'border-red-500/20');
            if (data.medication?.length) html += createEntityBlock('الأدوية', data.medication, 'text-emerald-300', 'bg-emerald-500/10', 'border-emerald-500/20');
            if (data.demographics) html += createEntityBlock('المعايير', [data.demographics], 'text-blue-300', 'bg-blue-500/10', 'border-blue-500/20');
            nerContainer.innerHTML = html || '<div class="text-center text-white/30 text-xs">لا توجد كيانات</div>';

            if (data.related_concepts) {
                document.getElementById('tagsContainer').innerHTML = data.related_concepts.map(tag =>
                    `<span class="px-2 py-1 rounded-md bg-white/5 text-[10px] text-white/50 border border-white/10 hover:text-white cursor-pointer">${tag}</span>`
                ).join('');
            }
        }

        function createEntityBlock(title, items, textC, bgC, borderC) {
            return `<div class="p-4 rounded-xl bg-white/5 border border-white/10">
                <div class="text-[10px] text-white/40 mb-2 uppercase tracking-widest">${title}</div>
                <div class="flex flex-wrap gap-2">${items.map(i => `<span class="px-2 py-1 rounded ${bgC} ${textC} text-xs border ${borderC}">${i}</span>`).join('')}</div>
            </div>`;
        }

        // --- Helpers ---
        function fillQuery(text) { userInput.value = text; handleSend(); }
        function toggleFilter(btn) {
            btn.parentElement.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        function setActive(link) {
            document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
        }
        function resetChat() { chatContainer.innerHTML = document.getElementById('welcomeState').outerHTML; document.getElementById('welcomeState').style.display = 'flex'; nerContainer.innerHTML = ''; }

        function updateStatus(isOnline) {
            if (isOnline) {
                statusBadge.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span> Online';
                statusBadge.className = "px-2 py-0.5 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-[10px] text-emerald-400 flex items-center gap-1";
            } else {
                statusBadge.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-yellow-500"></span> Demo Mode';
                statusBadge.className = "px-2 py-0.5 rounded-full bg-yellow-500/10 border border-yellow-500/20 text-[10px] text-yellow-400 flex items-center gap-1";
            }
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<iconify-icon icon="solar:info-circle-linear" class="text-yellow-400"></iconify-icon> <span class="text-xs text-white">${msg}</span>`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }
    </script>
</body>

</html>