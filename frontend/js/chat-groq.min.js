"use strict";const CHAT_CONFIG={apiKey:"gsk_yours_here",apiEndpoint:"https://api.groq.com/openai/v1/chat/completions",model:"mixtral-8x7b-32768",maxHistory:10};let isChatOpen=!1,messageHistory=[{role:"system",content:"You are a helpful AI assistant for Bright AI, a Saudi enterprise AI company. You speak Arabic and English. Be professional, concise, and helpful."}],isTyping=!1,lastRequestTime=0;const MIN_REQUEST_INTERVAL=2e3,chatWindow=document.getElementById("chat-window"),chatMessages=document.getElementById("chat-messages"),chatInput=document.getElementById("chat-input"),chatForm=document.getElementById("chat-form");function addMessage(e,t){if(!chatMessages)return;if("user"===t?messageHistory.push({role:"user",content:e}):messageHistory.push({role:"assistant",content:e}),messageHistory.length>CHAT_CONFIG.maxHistory+1){const e=messageHistory[0],t=messageHistory.slice(-CHAT_CONFIG.maxHistory);messageHistory=[e,...t]}const n=document.createElement("div");n.className="flex items-start gap-3 fade-in-up","bot"===t?n.innerHTML=`\n      <div class="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-300 shrink-0 border border-indigo-500/30">\n        <iconify-icon icon="lucide:bot" width="16"></iconify-icon>\n      </div>\n      <div class="bg-white/5 p-3 rounded-2xl rounded-tr-none text-slate-200 border border-white/5 text-right">\n        ${escapeHtml(e)}\n      </div>\n    `:(n.innerHTML=`\n      <div class="bg-indigo-600 p-3 rounded-2xl rounded-tl-none text-white mr-auto ml-0 border border-indigo-500">\n        ${escapeHtml(e)}\n      </div>\n      <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-slate-300 shrink-0 border border-slate-600">\n        <iconify-icon icon="lucide:user" width="16"></iconify-icon>\n      </div>\n    `,n.classList.add("flex-row-reverse")),chatMessages.appendChild(n),scrollToBottom()}function showTypingIndicator(){isTyping=!0;const e=document.createElement("div");e.id="typing-indicator",e.className="flex items-start gap-3 fade-in-up",e.innerHTML='\n    <div class="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-300 shrink-0 border border-indigo-500/30">\n      <iconify-icon icon="lucide:bot" width="16"></iconify-icon>\n    </div>\n    <div class="bg-white/5 p-4 rounded-2xl rounded-tr-none border border-white/5 flex gap-1 items-center h-10">\n      <div class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0s"></div>\n      <div class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>\n      <div class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>\n    </div>\n  ',chatMessages.appendChild(e),scrollToBottom()}function removeTypingIndicator(){isTyping=!1;const e=document.getElementById("typing-indicator");e&&e.remove()}async function callGroqAPI(e){if("gsk_yours_here"===CHAT_CONFIG.apiKey)return"عذراً، لم يتم إعداد مفتاح API. يرجى مراجعة إعدادات النظام.";const t=await fetch(CHAT_CONFIG.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${CHAT_CONFIG.apiKey}`},body:JSON.stringify({model:CHAT_CONFIG.model,messages:messageHistory,temperature:.7,max_tokens:1024})});if(!t.ok){const e=await t.json();throw new Error(e.error?.message||"API request failed")}const n=await t.json();return n.choices[0]?.message?.content||"عذراً، لم أتمكن من فهم ذلك."}function scrollToBottom(){chatMessages&&(chatMessages.scrollTop=chatMessages.scrollHeight)}function escapeHtml(e){if("undefined"!=typeof DOMUtils&&DOMUtils.escapeHtml){return DOMUtils.escapeHtml(e).replace(/\n/g,"<br>")}const t=document.createElement("div");return t.textContent=e,t.innerHTML.replace(/\n/g,"<br>")}window.toggleChat=function(){isChatOpen=!isChatOpen,chatWindow&&(chatWindow.classList.toggle("open",isChatOpen),chatWindow.setAttribute("aria-hidden",!isChatOpen),isChatOpen&&chatInput&&setTimeout(()=>chatInput.focus(),300))},window.handleChatSubmit=async function(e){if(e.preventDefault(),!chatInput||isTyping)return;const t=Date.now();if(t-lastRequestTime<2e3)return;lastRequestTime=t;const n=chatInput.value.trim();if(n){addMessage(n,"user"),chatInput.value="",showTypingIndicator();try{const e=await callGroqAPI(n);removeTypingIndicator(),addMessage(e,"bot")}catch(e){removeTypingIndicator(),addMessage("عذراً، حدث خطأ في الاتصال. يرجى المحاولة لاحقاً.","bot")}}};const style=document.createElement("style");style.textContent="\n  .fade-in-up {\n    animation: fadeInUp 0.3s ease-out forwards;\n  }\n  @keyframes fadeInUp {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n",document.head.appendChild(style);