# خطة التنفيذ: تحسينات مشروع BrightAI

## نظرة عامة

هذه الخطة تغطي تنفيذ جميع التحسينات المطلوبة لمشروع BrightAI، مرتبة حسب الأولوية من الإصلاحات الحرجة إلى الميزات الجديدة. كل مهمة تبني على المهام السابقة وتنتهي بربط جميع المكونات معاً.

## المهام

### المرحلة 1: الإصلاحات الحرجة

- [-] 1. إصلاح خطأ API endpoint في medical.js
  - تصحيح استخدام `config.gemini.baseUrl` إلى `config.gemini.endpoint` في السطر 35
  - التأكد من مطابقة النمط المستخدم في endpoints أخرى
  - _المتطلبات: 1.1، 1.2، 1.3_

- [ ] 2. تصحيح نص Prompt في summary.js
  - استبدال النص المختلط (ألماني/إنجليزي) بنص عربي كامل
  - إضافة إشارة صريحة للجمهور السعودي ورؤية 2030
  - تحديث رسائل الخطأ لتكون عربية
  - _المتطلبات: 2.1، 2.2_

- [ ] 3. معالجة حقل URL في summary endpoint
  - إزالة التحقق من حقل `url` مؤقتاً
  - تحديث validation للتحقق من `text` فقط
  - تحديث رسالة الخطأ لتكون واضحة
  - _المتطلبات: 3.1_

- [ ] 4. تنظيف package.json من التبعيات غير المستخدمة
  - إزالة `pdfjs-dist` من dependencies (سيتم إعادة إضافتها لاحقاً)
  - التحقق من عدم وجود استيرادات لـ pdfjs-dist في الكود
  - _المتطلبات: 5.1، 5.2_

- [ ] 5. Checkpoint - التحقق من الإصلاحات الحرجة
  - التأكد من أن جميع endpoints تعمل بشكل صحيح
  - اسأل المستخدم إذا كانت هناك أسئلة

### المرحلة 2: البنية التحتية للاختبارات

- [ ] 6. إعداد بنية الاختبارات
  - [ ] 6.1 إنشاء مجلدات الاختبارات (tests/unit, tests/property, tests/helpers)
    - _المتطلبات: 6.1_
  
  - [ ] 6.2 إنشاء ملفات مساعدة للاختبارات
    - إنشاء `tests/helpers/mockGeminiApi.js` لمحاكاة Gemini API
    - إنشاء `tests/helpers/testUtils.js` للوظائف المساعدة
    - _المتطلبات: 6.1_

- [ ] 7. إنشاء وحدة معالجة الأخطاء
  - [ ] 7.1 إنشاء `server/utils/errorHandler.js`
    - تعريف جميع أكواد الأخطاء (ERROR_CODES)
    - تنفيذ دالة `sendError` لإرجاع أخطاء موحدة
    - _المتطلبات: 8.1، 8.2، 8.4_
  
  - [ ]* 7.2 كتابة property test لبنية استجابة الخطأ
    - **الخاصية 5: بنية استجابة الخطأ الموحدة**
    - **يتحقق من: المتطلبات 8.1، 8.2، 8.4**

- [ ] 8. إنشاء وحدة التحقق من المدخلات
  - [ ] 8.1 إنشاء `server/utils/validation.js`
    - تنفيذ `validateTextInput` للتحقق من النصوص
    - تنفيذ `validateFileUpload` للتحقق من الملفات
    - _المتطلبات: 7.2_
  
  - [ ]* 8.2 كتابة property test للتحقق من المدخلات
    - **الخاصية 3: رفض المدخلات غير الصالحة**
    - **يتحقق من: المتطلبات 7.2**

### المرحلة 3: اختبارات Endpoints

- [ ] 9. اختبارات Chat Endpoint
  - [ ]* 9.1 كتابة unit tests لـ chat endpoint
    - اختبار مدخلات صالحة
    - اختبار مدخلات فارغة (400)
    - اختبار API key مفقود (503)
    - _المتطلبات: 6.1، 6.2_
  
  - [ ]* 9.2 كتابة property test لبنية استجابة HTTP
    - **الخاصية 2: بنية استجابة HTTP صحيحة**
    - **يتحقق من: المتطلبات 6.3، 6.4**

- [ ] 10. اختبارات Search Endpoint
  - [ ]* 10.1 كتابة unit tests لـ search endpoint
    - اختبار query صالح
    - اختبار query فارغ (400)
    - اختبار API key مفقود (503)
    - _المتطلبات: 6.1، 6.2_

- [ ] 11. اختبارات Medical Endpoint
  - [ ]* 11.1 كتابة unit tests لـ medical endpoint
    - اختبار textParts صالح
    - اختبار textParts فارغ (400)
    - اختبار inlineDataParts غير صالح (400)
    - اختبار API key مفقود (503)
    - _المتطلبات: 6.1، 6.2_
  
  - [ ]* 11.2 كتابة property test لاتساق بناء URL
    - **الخاصية 1: اتساق بناء URL لـ Gemini API**
    - **يتحقق من: المتطلبات 1.2**

- [ ] 12. اختبارات Summary Endpoint
  - [ ]* 12.1 كتابة unit tests لـ summary endpoint
    - اختبار text صالح
    - اختبار text فارغ (400)
    - اختبار API key مفقود (503)
    - التحقق من أن prompt عربي كامل
    - _المتطلبات: 6.1، 6.2، 2.1_

- [ ] 13. Checkpoint - التحقق من الاختبارات الأساسية
  - تشغيل `npm test` والتأكد من نجاح جميع الاختبارات
  - اسأل المستخدم إذا كانت هناك أسئلة

### المرحلة 4: تحسين Rate Limiter

- [ ] 14. تحسين Rate Limiter
  - [ ] 14.1 إعادة كتابة `server/middleware/rateLimiter.js`
    - تنفيذ class RateLimiter مع دعم memory و Redis
    - إضافة دالة cleanup لتنظيف البيانات القديمة
    - إضافة دعم لمتغير بيئة RATE_LIMIT_STORAGE
    - _المتطلبات: 12.1، 12.2، 12.3، 12.4_
  
  - [ ]* 14.2 كتابة property test لـ rate limiter
    - **الخاصية 4: احترام حدود Rate Limiter**
    - **يتحقق من: المتطلبات 7.3**
  
  - [ ]* 14.3 كتابة property test لاستمرارية البيانات
    - **الخاصية 6: استمرارية بيانات Rate Limiter**
    - **يتحقق من: المتطلبات 12.1**

### المرحلة 5: نظام Caching

- [ ] 15. تنفيذ نظام Caching
  - [ ] 15.1 إنشاء `server/utils/cache.js`
    - تنفيذ class CacheManager مع دعم memory و Redis
    - تنفيذ دوال generateKey, get, set, clear
    - إضافة حد أقصى لحجم cache في memory mode
    - _المتطلبات: 13.1، 13.2، 13.4، 13.5_
  
  - [ ] 15.2 دمج cache في endpoints
    - تحديث summary endpoint لاستخدام cache
    - إضافة X-Cache header (HIT/MISS)
    - _المتطلبات: 13.1، 13.3_
  
  - [ ]* 15.3 كتابة property test للـ cache
    - **الخاصية 7: Cache يخدم الطلبات المتطابقة**
    - **يتحقق من: المتطلبات 13.1، 13.3**

- [ ] 16. Checkpoint - التحقق من التحسينات
  - تشغيل جميع الاختبارات والتأكد من نجاحها
  - اسأل المستخدم إذا كانت هناك أسئلة

### المرحلة 6: الوثائق

- [ ] 17. تحديث README.md
  - إضافة نظرة عامة شاملة عن المشروع
  - إضافة قسم الميزات
  - إضافة خطوات التثبيت المفصلة
  - إضافة شرح لإعداد ملف .env
  - إضافة أمثلة curl لكل endpoint
  - إضافة قسم البنية المعمارية
  - إضافة قسم الاختبارات
  - _المتطلبات: 4.1، 4.2، 4.3، 4.4، 4.5_

- [ ] 18. إنشاء وثائق OpenAPI
  - [ ] 18.1 إنشاء `docs/openapi.yaml`
    - توثيق جميع endpoints (chat, search, medical, summary)
    - توثيق جميع request/response schemas
    - توثيق جميع أكواد الأخطاء
    - _المتطلبات: 9.2، 9.3، 9.4_
  
  - [ ] 18.2 إضافة Swagger UI endpoint
    - إضافة endpoint `/api/docs` لعرض Swagger UI
    - إضافة endpoint `/api/docs/openapi.yaml` لتقديم ملف YAML
    - _المتطلبات: 9.1_

- [ ] 19. تحسين .gitignore
  - تنظيم القواعد بتعليقات واضحة
  - إضافة قواعد لملفات البيئة (.env)
  - إضافة قواعد لـ node_modules ومجلدات البناء
  - إضافة قواعد لملفات IDE
  - إزالة القواعد المتكررة
  - _المتطلبات: 10.1، 10.2، 10.3_

### المرحلة 7: واجهة تجريبية

- [ ] 20. إنشاء واجهة تجريبية
  - [ ] 20.1 إنشاء `frontend/demo.html`
    - تصميم واجهة بسيطة ونظيفة بالعربية
    - إضافة أزرار لاختيار الخدمة (chat, search, medical, summary)
    - إضافة نماذج إدخال لكل خدمة
    - إضافة منطقة لعرض الاستجابات
    - _المتطلبات: 11.1، 11.2، 11.3_
  
  - [ ] 20.2 إضافة معالجة الأخطاء في الواجهة
    - عرض رسائل الخطأ بشكل واضح
    - معالجة أخطاء الشبكة
    - _المتطلبات: 11.4_
  
  - [ ]* 20.3 كتابة unit tests للواجهة
    - اختبار عرض النماذج الصحيحة
    - اختبار إرسال الطلبات
    - اختبار عرض الاستجابات
    - _المتطلبات: 11.2، 11.3، 11.4_

- [ ] 21. Checkpoint - التحقق من الوثائق والواجهة
  - مراجعة README.md والتأكد من اكتماله
  - اختبار Swagger UI على /api/docs
  - اختبار الواجهة التجريبية
  - اسأل المستخدم إذا كانت هناك أسئلة

### المرحلة 8: دعم PDF (اختياري)

- [ ] 22. إضافة دعم رفع ملفات PDF
  - [ ] 22.1 إعادة إضافة pdfjs-dist إلى package.json
    - إضافة التبعية في dependencies
    - _المتطلبات: 14.1_
  
  - [ ] 22.2 إنشاء `server/endpoints/pdf-summary.js`
    - تنفيذ parseMultipartPDF لتحليل multipart form data
    - تنفيذ extractTextFromPDF باستخدام pdfjs-dist
    - تنفيذ pdfSummaryHandler للمعالجة الكاملة
    - التحقق من نوع الملف وحجمه (max 10MB)
    - حذف الملفات المؤقتة بعد المعالجة
    - _المتطلبات: 14.1، 14.2، 14.3، 14.4، 14.5_
  
  - [ ] 22.3 إضافة endpoint في server/index.js
    - إضافة route لـ POST /api/ai/pdf-summary
    - _المتطلبات: 14.2_
  
  - [ ]* 22.4 كتابة property test لاستخراج PDF
    - **الخاصية 8: استخراج نص من PDF صالح**
    - **يتحقق من: المتطلبات 14.1**
  
  - [ ]* 22.5 كتابة property test للتحقق من الملفات
    - **الخاصية 9: التحقق من نوع وحجم الملف**
    - **يتحقق من: المتطلبات 14.3**
  
  - [ ]* 22.6 كتابة property test لحذف الملفات المؤقتة
    - **الخاصية 10: حذف الملفات المؤقتة**
    - **يتحقق من: المتطلبات 14.5**
  
  - [ ]* 22.7 كتابة unit tests لـ PDF endpoint
    - اختبار رفع PDF صالح
    - اختبار رفع ملف كبير جداً (413)
    - اختبار رفع نوع ملف غير مدعوم (400)
    - اختبار فشل استخراج النص
    - _المتطلبات: 14.3، 14.4_

- [ ] 23. تحديث الواجهة التجريبية لدعم PDF
  - إضافة نموذج لرفع ملفات PDF
  - إضافة معالجة لاستجابة PDF summary
  - _المتطلبات: 11.1_

- [ ] 24. تحديث وثائق OpenAPI لـ PDF endpoint
  - إضافة توثيق لـ /api/ai/pdf-summary
  - توثيق multipart/form-data request
  - _المتطلبات: 9.2_

### المرحلة 9: الاختبار النهائي والتوثيق

- [ ] 25. الاختبار الشامل
  - تشغيل جميع الاختبارات (unit + property)
  - التأكد من نجاح جميع الاختبارات
  - مراجعة تغطية الاختبارات
  - _المتطلبات: 6.5، 7.4_

- [ ] 26. تحديث .env.example
  - إضافة متغيرات جديدة (RATE_LIMIT_STORAGE، CACHE_ENABLED، CACHE_STORAGE، CACHE_TTL)
  - إضافة تعليقات توضيحية لكل متغير
  - _المتطلبات: 4.3_

- [ ] 27. Checkpoint النهائي
  - مراجعة جميع التحسينات
  - التأكد من عمل جميع الميزات
  - اسأل المستخدم إذا كانت هناك أسئلة أو تحسينات إضافية

## ملاحظات

- المهام المميزة بـ `*` اختيارية ويمكن تخطيها للحصول على MVP أسرع
- كل مهمة تشير إلى المتطلبات التي تغطيها للتتبع
- Checkpoints تضمن التحقق التدريجي من التقدم
- Property tests تشغل 100 تكرار على الأقل لكل اختبار
- Unit tests تركز على أمثلة محددة وحالات حدية
- المرحلة 8 (دعم PDF) اختيارية بالكامل ويمكن تأجيلها
