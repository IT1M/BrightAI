# وثيقة المتطلبات: تحسينات مشروع BrightAI

## المقدمة

مشروع BrightAI هو منصة ذكاء اصطناعي موجهة للسوق السعودي، تقدم خدمات API متعددة (محادثة ذكية، بحث ذكي، تحليل طبي، تلخيص نصوص) بالإضافة إلى موقع ويب ثابت. تم اكتشاف عدة مشاكل تقنية حرجة ومجالات تحسين تؤثر على جودة الخدمة وموثوقيتها. هذه الوثيقة تحدد المتطلبات اللازمة لإصلاح المشاكل الحرجة وتحسين جودة المشروع بشكل شامل.

## المصطلحات

- **النظام**: مشروع BrightAI بكامل مكوناته (خادم API، موقع ويب، خدمات AI)
- **الخادم**: خادم Node.js الذي يستضيف API endpoints
- **Gemini_API**: واجهة برمجة تطبيقات Google Gemini المستخدمة لخدمات الذكاء الاصطناعي
- **Endpoint**: نقطة نهاية API محددة (مثل /api/ai/chat)
- **Rate_Limiter**: آلية تحديد معدل الطلبات لمنع إساءة الاستخدام
- **Property_Test**: اختبار يتحقق من خاصية عامة عبر مدخلات متعددة مولدة عشوائياً
- **Unit_Test**: اختبار يتحقق من وحدة كود محددة بمدخلات معروفة
- **Config_Object**: كائن الإعدادات المحمل من ملف config/index.js
- **Prompt**: النص المرسل إلى Gemini API لتوليد الاستجابة
- **CORS**: آلية مشاركة الموارد عبر المصادر المختلفة

## المتطلبات

### المتطلب 1: إصلاح خطأ API endpoint في medical.js

**قصة المستخدم:** كمطور، أريد أن يستخدم medical endpoint المتغير الصحيح من Config_Object، حتى تعمل طلبات API بشكل صحيح.

#### معايير القبول

1. WHEN يتم استدعاء medical endpoint، THEN THE النظام SHALL يستخدم `config.gemini.endpoint` بدلاً من `config.gemini.baseUrl`
2. WHEN يتم بناء URL لـ Gemini API، THEN THE النظام SHALL يطابق النمط المستخدم في endpoints أخرى (chat.js، summary.js)
3. WHEN يتم اختبار medical endpoint، THEN THE النظام SHALL يرجع استجابة ناجحة مع API key صالح

### المتطلب 2: تصحيح نص Prompt في summary.js

**قصة المستخدم:** كمستخدم سعودي، أريد أن تكون جميع تعليمات AI باللغة العربية، حتى أحصل على نتائج متسقة ومناسبة ثقافياً.

#### معايير القبول

1. WHEN يتم إنشاء prompt في summary endpoint، THEN THE النظام SHALL يستخدم نصاً عربياً كاملاً بدون خلط لغات
2. WHEN يتم توليد الملخص، THEN THE النظام SHALL يشير صراحة إلى الجمهور السعودي ورؤية 2030
3. WHEN يتم مراجعة الكود، THEN THE النظام SHALL لا يحتوي على نصوص ألمانية أو إنجليزية في prompts

### المتطلب 3: معالجة حقل URL في summary endpoint

**قصة المستخدم:** كمطور API، أريد معالجة واضحة لحقل url في summary endpoint، حتى لا يكون هناك التباس في الوظيفة المتوقعة.

#### معايير القبول

1. IF حقل url موجود في الطلب، THEN THE النظام SHALL إما يجلب محتوى URL أو يرجع خطأ واضح
2. IF حقل url غير مدعوم حالياً، THEN THE النظام SHALL يزيل التحقق منه من الكود
3. WHEN يتم توثيق API، THEN THE النظام SHALL يوضح ما إذا كان url مدعوماً أم لا

### المتطلب 4: تحديث وثائق README.md

**قصة المستخدم:** كمطور جديد، أريد وثائق واضحة وشاملة، حتى أتمكن من تثبيت وتشغيل المشروع بسهولة.

#### معايير القبول

1. WHEN يتم فتح README.md، THEN THE النظام SHALL يعرض وصفاً واضحاً للمشروع وأهدافه
2. WHEN يحتاج مطور للتثبيت، THEN THE النظام SHALL يوفر خطوات تثبيت مفصلة خطوة بخطوة
3. WHEN يحتاج مطور لإعداد البيئة، THEN THE النظام SHALL يشرح كيفية إعداد ملف .env
4. WHEN يحتاج مطور لاختبار API، THEN THE النظام SHALL يوفر أمثلة curl أو Postman لكل endpoint
5. WHEN يتم قراءة الوثائق، THEN THE النظام SHALL يتضمن قسماً عن البنية المعمارية للمشروع

### المتطلب 5: تنظيف package.json من التبعيات غير المستخدمة

**قصة المستخدم:** كمطور، أريد ملف package.json نظيفاً، حتى لا أثبت تبعيات غير ضرورية تزيد حجم المشروع.

#### معايير القبول

1. WHEN يتم مراجعة package.json، THEN THE النظام SHALL يزيل أي تبعية غير مستخدمة في الكود
2. WHEN يتم البحث عن استخدام pdfjs-dist، THEN THE النظام SHALL لا يجد أي استيراد أو استخدام لها
3. WHEN يتم تثبيت التبعيات، THEN THE النظام SHALL يثبت فقط الحزم المطلوبة فعلياً

### المتطلب 6: إضافة اختبارات Unit Tests لجميع Endpoints

**قصة المستخدم:** كمطور، أريد اختبارات شاملة لكل endpoint، حتى أتأكد من عمل الوظائف بشكل صحيح.

#### معايير القبول

1. WHEN يتم تشغيل الاختبارات، THEN THE النظام SHALL يختبر كل endpoint بمدخلات صالحة
2. WHEN يتم اختبار endpoint، THEN THE النظام SHALL يتحقق من حالات الخطأ (مدخلات فارغة، API key مفقود)
3. WHEN يتم اختبار استجابة، THEN THE النظام SHALL يتحقق من بنية JSON الصحيحة
4. WHEN يتم اختبار CORS، THEN THE النظام SHALL يتحقق من وجود headers الصحيحة
5. WHEN يتم تشغيل npm test، THEN THE النظام SHALL يشغل جميع الاختبارات وينجح

### المتطلب 7: إضافة Property-Based Tests للتحقق من صحة المدخلات

**قصة المستخدم:** كمطور، أريد اختبارات property-based، حتى أتحقق من صحة النظام عبر نطاق واسع من المدخلات.

#### معايير القبول

1. WHEN يتم تشغيل property tests، THEN THE النظام SHALL يولد مدخلات عشوائية متنوعة
2. WHEN يتم اختبار validation، THEN THE النظام SHALL يرفض جميع المدخلات غير الصالحة
3. WHEN يتم اختبار rate limiter، THEN THE النظام SHALL يحترم الحدود المعرفة عبر طلبات متعددة
4. WHEN يتم تشغيل الاختبارات، THEN THE النظام SHALL يشغل كل property test لـ 100 تكرار على الأقل

### المتطلب 8: تحسين معالجة الأخطاء ورسائل الخطأ

**قصة المستخدم:** كمستخدم API، أريد رسائل خطأ واضحة ومفيدة، حتى أفهم المشكلة وكيفية إصلاحها.

#### معايير القبول

1. WHEN يحدث خطأ، THEN THE النظام SHALL يرجع رسالة خطأ عربية واضحة
2. WHEN يحدث خطأ، THEN THE النظام SHALL يتضمن errorCode فريد لكل نوع خطأ
3. WHEN يحدث خطأ في Gemini API، THEN THE النظام SHALL يسجل التفاصيل في console دون كشف معلومات حساسة
4. WHEN يتم إرجاع خطأ، THEN THE النظام SHALL يستخدم HTTP status code المناسب (400، 401، 429، 500، 503)
5. IF يحدث خطأ غير متوقع، THEN THE النظام SHALL يرجع رسالة عامة دون كشف تفاصيل داخلية

### المتطلب 9: إضافة وثائق API (OpenAPI/Swagger)

**قصة المستخدم:** كمطور يستخدم API، أريد وثائق تفاعلية، حتى أفهم كيفية استخدام كل endpoint دون قراءة الكود.

#### معايير القبول

1. WHEN يتم الوصول إلى /api/docs، THEN THE النظام SHALL يعرض واجهة Swagger UI
2. WHEN يتم عرض الوثائق، THEN THE النظام SHALL يوثق جميع endpoints مع أمثلة طلبات واستجابات
3. WHEN يتم قراءة وثائق endpoint، THEN THE النظام SHALL يشرح جميع المعاملات المطلوبة والاختيارية
4. WHEN يتم توثيق الأخطاء، THEN THE النظام SHALL يسرد جميع أكواد الأخطاء الممكنة مع معانيها
5. WHEN يتم تحديث endpoint، THEN THE النظام SHALL يعكس التغييرات في ملف OpenAPI spec

### المتطلب 10: تنظيف وتحسين .gitignore

**قصة المستخدم:** كمطور، أريد ملف .gitignore منظم، حتى لا يتم تتبع ملفات غير ضرورية في Git.

#### معايير القبول

1. WHEN يتم مراجعة .gitignore، THEN THE النظام SHALL يحتوي على قواعد منظمة بتعليقات واضحة
2. WHEN يتم إضافة ملفات جديدة، THEN THE النظام SHALL يتجاهل ملفات البيئة (.env) وملفات IDE
3. WHEN يتم إضافة ملفات جديدة، THEN THE النظام SHALL يتجاهل node_modules ومجلدات البناء
4. WHEN يتم مراجعة القواعد، THEN THE النظام SHALL لا يحتوي على قواعد متكررة أو متضاربة

### المتطلب 11: إضافة واجهة مستخدم بسيطة لتجربة الخدمات

**قصة المستخدم:** كمستخدم نهائي، أريد واجهة ويب بسيطة، حتى أجرب خدمات AI دون الحاجة لأدوات تقنية.

#### معايير القبول

1. WHEN يتم الوصول إلى /demo.html، THEN THE النظام SHALL يعرض واجهة تفاعلية لاختبار الخدمات
2. WHEN يتم اختيار خدمة، THEN THE النظام SHALL يعرض نموذج مناسب لإدخال البيانات
3. WHEN يتم إرسال طلب، THEN THE النظام SHALL يعرض الاستجابة بشكل منسق وواضح
4. WHEN يحدث خطأ، THEN THE النظام SHALL يعرض رسالة الخطأ بشكل واضح للمستخدم
5. WHEN يتم استخدام الواجهة، THEN THE النظام SHALL يدعم اللغة العربية بالكامل في UI

### المتطلب 12: تحسين Rate Limiter بإضافة خيارات تخزين دائمة

**قصة المستخدم:** كمدير نظام، أريد rate limiter يحتفظ بالبيانات عند إعادة التشغيل، حتى لا يتمكن المستخدمون من تجاوز الحدود بإعادة تشغيل الخادم.

#### معايير القبول

1. WHEN يتم إعادة تشغيل الخادم، THEN THE النظام SHALL يحتفظ ببيانات rate limiting من الجلسة السابقة
2. WHERE يتم تفعيل Redis، THEN THE النظام SHALL يستخدم Redis لتخزين بيانات rate limiting
3. WHERE لا يتوفر Redis، THEN THE النظام SHALL يستخدم الذاكرة كخيار احتياطي
4. WHEN يتم تكوين rate limiter، THEN THE النظام SHALL يسمح بتحديد نوع التخزين عبر متغير بيئة

### المتطلب 13: إضافة نظام Caching للاستجابات

**قصة المستخدم:** كمدير نظام، أريد caching للاستجابات المتكررة، حتى أقلل التكلفة والوقت لطلبات API المتشابهة.

#### معايير القبول

1. WHEN يتم استقبال طلب متطابق، THEN THE النظام SHALL يرجع الاستجابة من cache إذا كانت صالحة
2. WHEN يتم تخزين استجابة، THEN THE النظام SHALL يحدد مدة صلاحية مناسبة (TTL)
3. WHEN يتم تفعيل caching، THEN THE النظام SHALL يضيف header يشير إلى ما إذا كانت الاستجابة من cache
4. WHERE يتوفر Redis، THEN THE النظام SHALL يستخدم Redis للتخزين المؤقت
5. WHERE لا يتوفر Redis، THEN THE النظام SHALL يستخدم ذاكرة محلية بحد أقصى للحجم

### المتطلب 14: دعم رفع ملفات PDF للتلخيص

**قصة المستخدم:** كمستخدم، أريد رفع ملفات PDF للحصول على ملخص، حتى لا أحتاج لنسخ النص يدوياً.

#### معايير القبول

1. WHEN يتم رفع ملف PDF، THEN THE النظام SHALL يستخرج النص من الملف
2. WHEN يتم استخراج النص، THEN THE النظام SHALL يرسله إلى summary endpoint للمعالجة
3. WHEN يتم رفع ملف، THEN THE النظام SHALL يتحقق من نوع الملف وحجمه (حد أقصى 10MB)
4. IF فشل استخراج النص، THEN THE النظام SHALL يرجع رسالة خطأ واضحة
5. WHEN يتم معالجة PDF، THEN THE النظام SHALL يحذف الملف المؤقت بعد المعالجة
