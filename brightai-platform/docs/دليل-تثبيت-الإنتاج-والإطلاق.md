# دليل تثبيت الإنتاج والإطلاق

## ١) تثبيت بيئة الإنتاج

1. افتح ملف `.env.production`.
2. ثبّت هذه القيم:
   - `REACT_APP_SUPABASE_URL`
   - `REACT_APP_SUPABASE_ANON_KEY`
   - `REACT_APP_DEFAULT_LOCALE=ar-SA`
   - `REACT_APP_TIMEZONE=Asia/Riyadh`
3. فعّل مفاتيح القياس والمراقبة عند الجاهزية:
   - `REACT_APP_ANALYTICS_KEY`
   - `REACT_APP_ANALYTICS_PROVIDER=ga4`
   - `REACT_APP_SENTRY_DSN`
   - `REACT_APP_SENTRY_TRACES_SAMPLE_RATE=0.15`
   - `REACT_APP_RELEASE=brightai-platform@x.y.z`
4. نفّذ:
   - `npm run verify:prod`

## ٢) اختبار تدفق الأعمال الكامل

1. عيّن بيانات اختبار مدير فعّال:
   - `SMOKE_ADMIN_EMAIL`
   - `SMOKE_ADMIN_PASSWORD`
2. نفّذ:
   - `npm run smoke:flow`
3. النتيجة المتوقعة:
   - تسجيل دخول ناجح
   - إنشاء وكيل
   - تحديث وكيل
   - حذف وكيل

## ٣) مراجعة سياسات الأمان

1. تأكد أن هجرات القاعدة مطبقة:
   - `supabase migration list -p "كلمة-مرور-قاعدة-البيانات"`
2. تحقق من سياسات جدول `organization_users` وأنها لا تستخدم استعلامًا ذاتيًا مباشرًا.
3. اختبر دورين:
   - مدير مؤسسة
   - مستخدم عادي
4. تحقق من:
   - عزل بيانات كل منظمة
   - منع إنشاء وكيل بدون عضوية منظمة

## ٤) فحص الأداء قبل الإطلاق

1. شغّل التطبيق محليًا ثم اختبر صفحة مصمم الوكلاء:
   - الكتابة في اسم الوكيل
   - تغيير الفئة
   - الحفظ كمسودة
2. راقب:
   - عدم تجمد الواجهة
   - استجابة الإدخال خلال أقل من ١٥٠ مللي ثانية

## ٥) الإطلاق النهائي

1. بناء نسخة الإنتاج:
   - `npm run build:prod`
2. تحليل الحجم:
   - `npm run analyze`
3. نشر النسخة على الاستضافة.
4. تنفيذ اختبار دخان سريع بعد النشر:
   - تسجيل دخول
   - إنشاء وكيل
   - فتح لوحة التحكم
