"use strict";const API_CONFIG=Object.freeze({BASE_URL:"/api",TIMEOUT_MS:3e4,MAX_RETRIES:3,RETRY_DELAY_MS:1e3,HEADERS:{"Content-Type":"application/json",Accept:"application/json"}});class APIError extends Error{constructor(t,r=0,e=null){super(t),this.name="APIError",this.status=r,this.data=e,this.isNetworkError=0===r,this.isClientError=r>=400&&r<500,this.isServerError=r>=500}}const BrightAPIClient=(()=>{let t=null;const r=async t=>(t.headers.get("content-type")||"").includes("application/json")?t.json():{text:await t.text()},e=async(t,s,o=0)=>{const{controller:n,timeoutId:i}=((t=API_CONFIG.TIMEOUT_MS)=>{const r=new AbortController,e=setTimeout(()=>r.abort(),t);return{controller:r,timeoutId:e}})(s.timeout);try{const e=await fetch(t,{...s,signal:n.signal});return clearTimeout(i),e.ok||await(async t=>{let e=null;try{e=await r(t)}catch{}const s=e?.error||e?.message||`حدث خطأ: ${t.status}`;throw new APIError(s,t.status,e)})(e),r(e)}catch(r){if(clearTimeout(i),"AbortError"===r.name)throw new APIError("انتهت مهلة الطلب. يرجى المحاولة مرة أخرى.",0);if(r instanceof TypeError&&o<API_CONFIG.MAX_RETRIES){const r=API_CONFIG.RETRY_DELAY_MS*Math.pow(2,o);return await(a=r,new Promise(t=>setTimeout(t,a))),e(t,s,o+1)}if(r instanceof APIError)throw r;throw new APIError(r.message||"حدث خطأ غير متوقع في الاتصال",0)}var a},s=async(r,s,o=null,n={})=>{const i=(t=>`${API_CONFIG.BASE_URL.endsWith("/")?API_CONFIG.BASE_URL.slice(0,-1):API_CONFIG.BASE_URL}${t.startsWith("/")?t:`/${t}`}`)(s),a={method:r.toUpperCase(),headers:{...API_CONFIG.HEADERS,...n},timeout:API_CONFIG.TIMEOUT_MS};t&&(a.headers["X-Session-ID"]=t),o&&"GET"!==r.toUpperCase()&&(a.body=JSON.stringify(o));const c=await e(i,a);return c.sessionId&&(t=c.sessionId),c};return{get:(t,r={})=>s("GET",t,null,r),post:(t,r,e={})=>s("POST",t,r,e),put:(t,r,e={})=>s("PUT",t,r,e),delete:(t,r={})=>s("DELETE",t,null,r),async chat(r,e=[]){return this.post("/ai/chat",{message:r,history:e,sessionId:t})},async search(t,r={}){return this.post("/search",{query:t,...r})},async summarize(t,r={}){return this.post("/summary",{text:t,...r})},async analyzeMedical(t){return this.post("/medical",t)},getSessionId:()=>t,setSessionId:r=>{t=r},clearSession:()=>{t=null},APIError:APIError}})();"undefined"!=typeof module&&module.exports&&(module.exports={BrightAPIClient:BrightAPIClient,APIError:APIError}),window.BrightAPIClient=BrightAPIClient;