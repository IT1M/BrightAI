class ProductsManager{constructor(){this.products=[],this.categories=[],this.filteredProducts=[],this.filters={category:"all",priceRange:"all",searchTerm:"",sortBy:"popular"},this.cart=[],this.comparison=[],this.maxComparison=3}async init(){try{await this.loadData(),this.loadCart(),this.setupEventListeners(),this.render(),this.updateCartDisplay()}catch(t){console.error("Error initializing products manager:",t),this.showError("حدث خطأ في تحميل المنتجات")}}async loadData(){try{const t=await fetch("data/products-data.json");if(!t.ok)throw new Error("Failed to load products data");const i=await t.json();this.products=i.products,this.categories=i.categories,this.filteredProducts=[...this.products],console.log(`Loaded ${this.products.length} products`)}catch(t){throw console.error("Error loading data:",t),t}}setupEventListeners(){document.querySelectorAll(".category-tab").forEach(t=>{t.addEventListener("click",i=>{i.preventDefault(),this.filters.category=t.dataset.category,this.updateActiveTab(t),this.applyFilters()})});const t=document.getElementById("search-input");t&&t.addEventListener("input",this.debounce(t=>{this.filters.searchTerm=t.target.value,this.applyFilters()},300));const i=document.getElementById("price-filter");i&&i.addEventListener("change",t=>{this.filters.priceRange=t.target.value,this.applyFilters()});const n=document.getElementById("sort-select");n&&n.addEventListener("change",t=>{this.filters.sortBy=t.target.value,this.applyFilters()});const e=document.getElementById("compare-btn");e&&e.addEventListener("click",()=>this.showComparison());const c=document.getElementById("clear-compare");c&&c.addEventListener("click",()=>this.clearComparison())}applyFilters(){let t=[...this.products];if("all"!==this.filters.category&&(t=t.filter(t=>t.category===this.filters.category)),"all"!==this.filters.priceRange&&(t=t.filter(t=>{const i=t.pricing.current;switch(this.filters.priceRange){case"low":return i<500;case"medium":return i>=500&&i<=2e3;case"high":return i>2e3;default:return!0}})),this.filters.searchTerm){const i=this.filters.searchTerm.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(i)||t.shortDescription.toLowerCase().includes(i)||t.features.some(t=>t.toLowerCase().includes(i)))}t=this.sortProducts(t,this.filters.sortBy),this.filteredProducts=t,this.render(),this.updateResultsCount()}sortProducts(t,i){const n=[...t];switch(i){case"price-low":return n.sort((t,i)=>t.pricing.current-i.pricing.current);case"price-high":return n.sort((t,i)=>i.pricing.current-t.pricing.current);case"rating":return n.sort((t,i)=>i.rating-t.rating);case"popular":return n.sort((t,i)=>i.reviews-t.reviews);case"name":return n.sort((t,i)=>t.name.localeCompare(i.name,"ar"));default:return n}}render(){const t=document.getElementById("products-grid");t&&(0!==this.filteredProducts.length?(t.innerHTML=this.filteredProducts.map(t=>this.renderProductCard(t)).join(""),this.animateCards(),this.attachProductEvents()):t.innerHTML=this.renderEmptyState())}renderProductCard(t){const i=this.categories.find(i=>i.id===t.category),n=t.pricing.discount,e=this.comparison.includes(t.id);return`\n            <div class="product-card glass-card" data-id="${t.id}" data-category="${t.category}">\n                ${t.badge?`<div class="product-badge">${t.badge}</div>`:""}\n                ${n?`<div class="product-discount">-${n}%</div>`:""}\n                \n                <div class="product-icon" style="background: ${i.color}20">\n                    <iconify-icon icon="${i.icon}" style="color: ${i.color}" width="32"></iconify-icon>\n                </div>\n\n                <div class="product-content">\n                    <h3>${t.name}</h3>\n                    <p class="product-description">${t.shortDescription}</p>\n                    \n                    <ul class="product-features">\n                        ${t.features.slice(0,3).map(t=>`\n                            <li>\n                                <iconify-icon icon="lucide:check" width="16"></iconify-icon>\n                                ${t}\n                            </li>\n                        `).join("")}\n                    </ul>\n                </div>\n\n                <div class="product-pricing">\n                    <div class="price-main">\n                        <span class="price-current">${t.pricing.current} ${t.pricing.currency}</span>\n                        ${t.pricing.original?`\n                            <span class="price-original">${t.pricing.original} ${t.pricing.currency}</span>\n                        `:""}\n                    </div>\n                </div>\n\n                <div class="product-meta">\n                    <span class="meta-item">\n                        <iconify-icon icon="lucide:clock" width="16"></iconify-icon>\n                        ${t.deliveryTime}\n                    </span>\n                    <span class="meta-item">\n                        <iconify-icon icon="lucide:star" width="16"></iconify-icon>\n                        ${t.rating} (${t.reviews})\n                    </span>\n                </div>\n\n                <div class="product-actions">\n                    <button class="btn-primary buy-btn" data-id="${t.id}">\n                        <iconify-icon icon="lucide:shopping-cart" width="18"></iconify-icon>\n                        شراء الآن\n                    </button>\n                    <button class="btn-secondary details-btn" data-id="${t.id}">\n                        <iconify-icon icon="lucide:info" width="18"></iconify-icon>\n                        التفاصيل\n                    </button>\n                    <button class="btn-icon btn-compare ${e?"active":""}" \n                            data-id="${t.id}" \n                            title="إضافة للمقارنة">\n                        <iconify-icon icon="lucide:git-compare" width="18"></iconify-icon>\n                    </button>\n                </div>\n            </div>\n        `}renderEmptyState(){return'\n            <div class="empty-state">\n                <iconify-icon icon="lucide:search-x" width="64"></iconify-icon>\n                <h3>لم نجد نتائج</h3>\n                <p>جرب تغيير معايير البحث أو الفلاتر</p>\n                <button class="btn-primary" onclick="productsManager.resetFilters()">\n                    إعادة تعيين الفلاتر\n                </button>\n            </div>\n        '}animateCards(){document.querySelectorAll(".product-card").forEach((t,i)=>{t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout(()=>{t.style.transition="all 0.4s ease",t.style.opacity="1",t.style.transform="translateY(0)"},50*i)})}attachProductEvents(){document.querySelectorAll(".buy-btn").forEach(t=>{t.addEventListener("click",i=>{const n=t.dataset.id;this.addToCart(n)})}),document.querySelectorAll(".details-btn").forEach(t=>{t.addEventListener("click",i=>{const n=t.dataset.id;this.showProductDetails(n)})}),document.querySelectorAll(".btn-compare").forEach(t=>{t.addEventListener("click",i=>{const n=t.dataset.id;this.toggleComparison(n)})})}addToCart(t){const i=this.products.find(i=>i.id===t);if(!i)return;const n=this.cart.find(i=>i.id===t);n?n.quantity++:this.cart.push({id:t,name:i.name,price:`${i.pricing.current} ${i.pricing.currency}`,quantity:1}),this.saveCart(),this.updateCartDisplay(),this.showNotification(`تمت إضافة "${i.name}" إلى السلة`)}showProductDetails(t){const i=this.products.find(i=>i.id===t);if(!i)return;const n=document.getElementById("product-details-modal");if(!n)return;const e=this.categories.find(t=>t.id===i.category);n.querySelector(".modal-body").innerHTML=`\n            <div class="product-details-header">\n                <div class="product-icon-large" style="background: ${e.color}20">\n                    <iconify-icon icon="${e.icon}" style="color: ${e.color}" width="48"></iconify-icon>\n                </div>\n                <h2>${i.name}</h2>\n                <p class="category-badge" style="background: ${e.color}20; color: ${e.color}">\n                    ${e.name}\n                </p>\n            </div>\n\n            <div class="product-details-content">\n                <p class="full-description">${i.fullDescription}</p>\n\n                <h3>المميزات الرئيسية</h3>\n                <ul class="features-list">\n                    ${i.features.map(t=>`\n                        <li>\n                            <iconify-icon icon="lucide:check-circle" width="20"></iconify-icon>\n                            ${t}\n                        </li>\n                    `).join("")}\n                </ul>\n\n                <div class="product-details-pricing">\n                    <div class="price-section">\n                        <span class="label">السعر:</span>\n                        <span class="price-large">${i.pricing.current} ${i.pricing.currency}</span>\n                        ${i.pricing.original?`\n                            <span class="price-original-large">${i.pricing.original} ${i.pricing.currency}</span>\n                        `:""}\n                    </div>\n                    <div class="delivery-section">\n                        <iconify-icon icon="lucide:truck" width="20"></iconify-icon>\n                        <span>مدة التسليم: ${i.deliveryTime}</span>\n                    </div>\n                    <div class="rating-section">\n                        <iconify-icon icon="lucide:star" width="20"></iconify-icon>\n                        <span>${i.rating} من 5 (${i.reviews} تقييم)</span>\n                    </div>\n                </div>\n\n                <div class="product-details-actions">\n                    <button class="btn-primary btn-large" onclick="productsManager.addToCart('${i.id}')">\n                        <iconify-icon icon="lucide:shopping-cart" width="20"></iconify-icon>\n                        إضافة إلى السلة\n                    </button>\n                    <button class="btn-secondary btn-large" onclick="productsManager.toggleComparison('${i.id}')">\n                        <iconify-icon icon="lucide:git-compare" width="20"></iconify-icon>\n                        إضافة للمقارنة\n                    </button>\n                </div>\n            </div>\n        `,n.classList.add("active"),document.body.style.overflow="hidden"}toggleComparison(t){const i=this.comparison.indexOf(t);if(i>-1)this.comparison.splice(i,1),this.updateCompareButton(t,!1);else{if(this.comparison.length>=this.maxComparison)return void this.showNotification(`يمكنك مقارنة ${this.maxComparison} منتجات كحد أقصى`,"warning");this.comparison.push(t),this.updateCompareButton(t,!0)}this.updateComparisonBar()}updateCompareButton(t,i){const n=document.querySelector(`.btn-compare[data-id="${t}"]`);n&&n.classList.toggle("active",i)}updateComparisonBar(){const t=document.getElementById("comparison-bar");if(!t)return;if(0===this.comparison.length)return void t.classList.remove("active");t.classList.add("active"),t.querySelector(".comparison-count").textContent=this.comparison.length;t.querySelector(".comparison-items").innerHTML=this.comparison.map(t=>`\n                <div class="comparison-item">\n                    <span>${this.products.find(i=>i.id===t).name}</span>\n                    <button onclick="productsManager.toggleComparison('${t}')">\n                        <iconify-icon icon="lucide:x" width="16"></iconify-icon>\n                    </button>\n                </div>\n            `).join("")}showComparison(){this.comparison.length<2?this.showNotification("اختر منتجين على الأقل للمقارنة","warning"):console.log("Show comparison modal")}clearComparison(){this.comparison=[],document.querySelectorAll(".btn-compare.active").forEach(t=>{t.classList.remove("active")}),this.updateComparisonBar()}loadCart(){const t=localStorage.getItem("brightAICart");if(t)try{this.cart=JSON.parse(t)}catch(t){console.error("Error loading cart:",t),this.cart=[]}}saveCart(){localStorage.setItem("brightAICart",JSON.stringify(this.cart))}updateCartDisplay(){const t=document.querySelector(".cart-count");if(t){const i=this.cart.reduce((t,i)=>t+i.quantity,0);t.textContent=i,t.style.display=i>0?"block":"none"}}updateActiveTab(t){document.querySelectorAll(".category-tab").forEach(t=>{t.classList.remove("active")}),t.classList.add("active")}updateResultsCount(){const t=document.getElementById("results-count");t&&(t.textContent=`عرض ${this.filteredProducts.length} من ${this.products.length} منتج`)}resetFilters(){this.filters={category:"all",priceRange:"all",searchTerm:"",sortBy:"popular"};const t=document.getElementById("search-input");t&&(t.value="");const i=document.getElementById("price-filter");i&&(i.value="all");const n=document.getElementById("sort-select");n&&(n.value="popular"),document.querySelectorAll(".category-tab").forEach(t=>{t.classList.remove("active"),"all"===t.dataset.category&&t.classList.add("active")}),this.applyFilters()}showNotification(t,i="success"){const n=document.createElement("div");n.className=`notification notification-${i}`,n.innerHTML=`\n            <iconify-icon icon="lucide:${"success"===i?"check-circle":"alert-circle"}" width="20"></iconify-icon>\n            <span>${t}</span>\n        `,document.body.appendChild(n),setTimeout(()=>n.classList.add("show"),10),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),300)},3e3)}showError(t){const i=document.getElementById("products-grid");i&&(i.innerHTML=`\n                <div class="error-state">\n                    <iconify-icon icon="lucide:alert-triangle" width="64"></iconify-icon>\n                    <h3>حدث خطأ</h3>\n                    <p>${t}</p>\n                    <button class="btn-primary" onclick="location.reload()">\n                        إعادة المحاولة\n                    </button>\n                </div>\n            `)}debounce(t,i){let n;return function(...e){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),t(...e)},i)}}}const productsManager=new ProductsManager;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>productsManager.init()):productsManager.init();