<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bright AI - حلول الذكاء الاصطناعي الطبية المتقدمة في السعودية</title>
  <meta name="description" content="حلول طبية متقدمة بالذكاء الاصطناعي لتحليل الصور الطبية، المراقبة الصحية عن بعد، إدارة المستشفيات، وتطبيقات Med-Gemini." />
  <style>
    :root{
      --bg:#0b1220;
      --card:#111a2e;
      --muted:#94a3b8;
      --text:#e6edf6;
      --accent:#6ee7b7;
      --accent-2:#38bdf8;
      --danger:#ef4444;
      --warn:#f59e0b;
      --ok:#22c55e;
      --border:#1f2a44;
      --shadow: 0 8px 30px rgba(0,0,0,0.25);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(180deg,#0b1220 0%, #0c1426 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",Tahoma,Arial,sans-serif}
    a{color:var(--accent-2);text-decoration:none}
    header{
      position:sticky;top:0;z-index:50;background:rgba(11,18,32,0.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)
    }
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:9px;background:linear-gradient(135deg,var(--accent) 0%, var(--accent-2) 100%);box-shadow:var(--shadow)}
    .brand h1{font-size:18px;margin:0}
    .nav ul{display:flex;gap:16px;list-style:none;margin:0;padding:0}
    .nav a{padding:8px 12px;border-radius:10px}
    .nav a:hover{background:rgba(255,255,255,0.06)}
    main{padding:24px 0 80px}
    .hero{
      display:grid;grid-template-columns:1.1fr 0.9fr;gap:22px;align-items:center;margin:22px 0 28px
    }
    .hero .card{padding:24px;border-radius:var(--radius);background:linear-gradient(180deg,#101a30 0%, #0f1a34 100%);border:1px solid var(--border);box-shadow:var(--shadow)}
    .title{font-size:28px;margin:0 0 8px}
    .subtitle{color:var(--muted);margin:0 0 16px}
    .btn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--accent) 0%, var(--accent-2) 100%);color:#062b35;border:none;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn:disabled{opacity:.7;cursor:not-allowed}
    .btn.secondary{background:#1b2a4d;color:var(--text);border:1px solid var(--border)}
    .grid{display:grid;gap:16px}
    .cards-3{grid-template-columns:repeat(3,1fr)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    h3{margin:0 0 10px}
    .muted{color:var(--muted)}
    .badge{display:inline-flex;align-items:center;gap:6px;background:#0d213e;border:1px solid var(--border);padding:6px 10px;border-radius:999px;color:#cfe5ff;font-size:12px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#0e233f;border:1px solid var(--border);color:#cfe5ff;font-size:12px}
    .section{margin:28px 0}
    .field{margin-bottom:12px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select,textarea{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0b1730;color:var(--text);outline:none
    }
    textarea{min-height:110px;resize:vertical}
    .inline{display:flex;gap:10px;align-items:center}
    .inline > *{flex:1}
    .uploader{border:1.5px dashed #2a3a60;border-radius:12px;padding:14px;text-align:center;background:#0b1730;color:var(--muted)}
    .uploader.drag{border-color:var(--accent-2);background:#0c1d3c}
    .status{padding:10px 12px;border-radius:10px;background:#0e1f3e;border:1px solid var(--border);color:#cfe5ff}
    .status.ok{border-color:#1d864d;background:#0f2c22}
    .status.warn{border-color:#a76a12;background:#2a210a}
    .status.err{border-color:#a21b1b;background:#2a0f0f}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .output{white-space:pre-wrap;background:#0b1730;border:1px solid var(--border);border-radius:12px;padding:12px;color:#dbeafe}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    .tabs button{padding:8px 12px;border:1px solid var(--border);background:#0c1d3c;color:var(--text);border-radius:10px;cursor:pointer}
    .tabs button.active{background:linear-gradient(135deg,#1b365a,#0e2444);border-color:#3563a3}
    .footer{margin-top:28px;padding:18px;border-top:1px solid var(--border);color:var(--muted);text-align:center}
    /* Responsive */
    @media (max-width: 860px){
      .hero{grid-template-columns:1fr}
      .cards-3{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Bright AI</h1>
      </div>
      <nav>
        <ul>
          <li><a href="#home">الرئيسية</a></li>
          <li><a href="#services">خدماتنا</a></li>
          <li><a href="#why">المميزات</a></li>
          <li><a href="#contact">تواصل معنا</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="home" class="container">
    <section class="hero">
      <div class="card">
        <div class="badge">ثورة الذكاء الاصطناعي في الرعاية الصحية السعودية</div>
        <h2 class="title">حلول طبية متقدمة لتحسين التشخيص والعناية بالمرضى</h2>
        <p class="subtitle">تحليل صور طبية، مراقبة عن بُعد، إدارة مستشفيات، وتطبيقات Med-Gemini متعددة الوسائط.</p>
        <div class="actions">
          <a class="btn" href="#try">احجز استشارتك المجانية الآن</a>
          <a class="btn secondary" href="#services">استعراض الخدمات</a>
        </div>
      </div>
      <div class="card">
        <div class="grid cards-3">
          <div class="pill">دقة عالية</div>
          <div class="pill">سرعة فائقة</div>
          <div class="pill">أمان البيانات</div>
        </div>
        <div style="height:12px"></div>
        <div class="status ok">متوافق مع أنظمة المملكة | خصوصية وضوابط وصول دقيقة</div>
        <div style="height:8px"></div>
        <div class="status">يدعم X-Ray, MRI, CT, Ultrasound + بيانات حيوية متعددة</div>
      </div>
    </section>

    <section id="services" class="section">
      <h2>خدماتنا المتميزة</h2>
      <div class="grid cards-3">
        <div class="card">
          <h3>تحليل الصور الطبية بالذكاء الاصطناعي</h3>
          <p class="muted">يدعم الأشعة السينية، الرنين المغناطيسي، الأشعة المقطعية، والموجات فوق الصوتية.</p>
          <a class="btn secondary" href="#image-ai">جرب النظام الآن</a>
        </div>
        <div class="card">
          <h3>المراقبة الصحية عن بُعد</h3>
          <p class="muted">قراءات أجهزة قابلة للارتداء وتنبيهات ذكية للطاقم الطبي.</p>
          <a class="btn secondary" href="#remote">جرب النظام الآن</a>
        </div>
        <div class="card">
          <h3>إدارة المستشفيات الذكية</h3>
          <p class="muted">جداول ذكية، إدارة مخزون، وتحليلات إنذار مبكر.</p>
          <a class="btn secondary" href="#hms">جرب النظام الآن</a>
        </div>
        <div class="card">
          <h3>تطبيقات Med-Gemini الطبية</h3>
          <p class="muted">تحليل تقارير معقدة، تلخيص، وإجابة استفسارات متعددة الوسائط.</p>
          <a class="btn secondary" href="#med-gemini">جرب النظام الآن</a>
        </div>
      </div>
    </section>

    <section id="try" class="section">
      <h2>تجربة فعلية مبنية على المدخلات</h2>
      <p class="muted">أدخل البيانات أو ارفع الصور ليتم توليد نتائج حقيقية من نموذج Gemini استناداً إلى المدخلات.</p>

      <!-- تبويب الخدمات -->
      <div class="tabs" role="tablist" aria-label="أقسام التجربة">
        <button class="active" data-tab="image-ai" role="tab">تحليل الصور الطبية</button>
        <button data-tab="remote" role="tab">المراقبة عن بُعد</button>
        <button data-tab="hms" role="tab">إدارة المستشفيات</button>
        <button data-tab="med-gemini" role="tab">تطبيقات Med‑Gemini</button>
      </div>

      <!-- تحليل الصور الطبية -->
      <section id="image-ai" class="card" aria-live="polite">
        <h3>تحليل الصور الطبية بالذكاء الاصطناعي</h3>
        <div class="row">
          <div>
            <div class="field">
              <label>اختر نوع الصورة</label>
              <select id="imgType">
                <option value="X-Ray">أشعة سينية (X-Ray)</option>
                <option value="MRI">رنين مغناطيسي (MRI)</option>
                <option value="CT">أشعة مقطعية (CT Scan)</option>
                <option value="Ultrasound">موجات فوق صوتية (Ultrasound)</option>
              </select>
            </div>
            <div class="field">
              <label>اسحب الصورة الطبية هنا أو انقر للرفع (JPG/PNG/DICOM)</label>
              <div id="imgDrop" class="uploader" tabindex="0">اسحب الملف هنا أو انقر للاختيار
                <input id="imgFile" type="file" accept=".jpg,.jpeg,.png,.dcm,.dicom" style="display:none">
              </div>
            </div>
            <div class="field">
              <label>ملاحظات سريرية اختيارية</label>
              <textarea id="imgNotes" placeholder="العمر، الأعراض، التاريخ المرضي، الموقع التشريحي..."></textarea>
            </div>
            <div class="actions">
              <button class="btn" id="analyzeImageBtn">تحليل الصورة الطبية</button>
              <button class="btn secondary" id="clearImageBtn">إعادة الضبط</button>
            </div>
          </div>
          <div>
            <div class="field">
              <label>الحالة</label>
              <div id="imgStatus" class="status">في انتظار المدخلات...</div>
            </div>
            <div class="field">
              <label>المخرجات</label>
              <div id="imgOutput" class="output"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- المراقبة الصحية عن بُعد -->
      <section id="remote" class="card" hidden aria-live="polite">
        <h3>المراقبة الصحية عن بُعد</h3>
        <div class="row">
          <div>
            <div class="inline">
              <div class="field">
                <label>معدل ضربات القلب (نبضة/د)</label>
                <input id="hr" type="number" min="20" max="240" placeholder="مثال: 82">
              </div>
              <div class="field">
                <label>ضغط الدم (انقباضي/انبساطي)</label>
                <input id="bp" type="text" placeholder="مثال: 120/80">
              </div>
            </div>
            <div class="inline">
              <div class="field">
                <label>تشبع الأكسجين SpO₂ (%)</label>
                <input id="spo2" type="number" min="50" max="100" placeholder="مثال: 97">
              </div>
              <div class="field">
                <label>مستوى السكر (mg/dL)</label>
                <input id="glucose" type="number" min="30" max="600" placeholder="مثال: 110">
              </div>
            </div>
            <div class="field">
              <label>الأعراض الملاحظة</label>
              <textarea id="symptoms" placeholder="دوخة، ألم صدر، ضيق تنفس..."></textarea>
            </div>
            <div class="actions">
              <button class="btn" id="analyzeVitalsBtn">تحليل البيانات الحيوية</button>
              <button class="btn secondary" id="clearVitalsBtn">إعادة الضبط</button>
            </div>
          </div>
          <div>
            <div class="field">
              <label>الحالة</label>
              <div id="vitalsStatus" class="status">في انتظار المدخلات...</div>
            </div>
            <div class="field">
              <label>المخرجات</label>
              <div id="vitalsOutput" class="output"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- إدارة المستشفيات -->
      <section id="hms" class="card" hidden aria-live="polite">
        <h3>نظام إدارة المستشفيات الذكية</h3>
        <div class="row">
          <div>
            <div class="field">
              <label>اختر القسم الطبي</label>
              <select id="dept">
                <option>الطوارئ</option>
                <option>أمراض القلب</option>
                <option>العظام</option>
                <option>طب الأطفال</option>
                <option>الجراحة</option>
              </select>
            </div>
            <div class="inline">
              <div class="field">
                <label>عمر المريض</label>
                <input id="age" type="number" min="0" max="120" placeholder="مثال: 54">
              </div>
              <div class="field">
                <label>جنس المريض</label>
                <select id="gender">
                  <option value="">اختر الجنس</option>
                  <option>ذكر</option>
                  <option>أنثى</option>
                </select>
              </div>
            </div>
            <div class="field">
              <label>وصف حالة المريض والأعراض</label>
              <textarea id="caseDesc" placeholder="وصف الحالة، التاريخ المرضي، علامات حرجة..."></textarea>
            </div>
            <div class="actions">
              <button class="btn" id="hmsAnalyzeBtn">معالجة البيانات وتقديم التوصيات</button>
              <button class="btn secondary" id="hmsClearBtn">إعادة الضبط</button>
            </div>
          </div>
          <div>
            <div class="field">
              <label>الحالة</label>
              <div id="hmsStatus" class="status">في انتظار المدخلات...</div>
            </div>
            <div class="field">
              <label>المخرجات</label>
              <div id="hmsOutput" class="output"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Med-Gemini -->
      <section id="med-gemini" class="card" hidden aria-live="polite">
        <h3>تطبيقات Med‑Gemini الطبية</h3>
        <div class="row">
          <div>
            <div class="field">
              <label>اختر نوع الاستفسار</label>
              <select id="mgType">
                <option>استفسار تشخيصي</option>
                <option>تحليل تقرير طبي</option>
                <option>معلومات طبية عامة</option>
                <option>خيارات العلاج</option>
              </select>
            </div>
            <div class="field">
              <label>وصف الاستفسار</label>
              <textarea id="mgQuery" placeholder="اكتب سؤالك أو الصق نص التقرير الطبي..."></textarea>
            </div>
            <div class="field">
              <label>رفع ملف طبي (اختياري) - PDF, DOC, TXT, JPG, PNG</label>
              <div id="mgDrop" class="uploader" tabindex="0">اسحب الملف هنا أو انقر للاختيار
                <input id="mgFile" type="file" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png" style="display:none">
              </div>
            </div>
            <div class="actions">
              <button class="btn" id="mgAnalyzeBtn">الحصول على تحليل Med‑Gemini</button>
              <button class="btn secondary" id="mgClearBtn">إعادة الضبط</button>
            </div>
          </div>
          <div>
            <div class="field">
              <label>الحالة</label>
              <div id="mgStatus" class="status">في انتظار المدخلات...</div>
            </div>
            <div class="field">
              <label>المخرجات</label>
              <div id="mgOutput" class="output"></div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <section id="why" class="section">
      <h2>لماذا تختار Bright AI؟</h2>
      <div class="grid cards-3">
        <div class="card">
          <div class="badge">🎯 دقة عالية</div>
          <p class="muted">نماذج حديثة لضمان أعلى مستويات الدقة في التشخيص والتحليل.</p>
        </div>
        <div class="card">
          <div class="badge">⚡️ سرعة فائقة</div>
          <p class="muted">نتائج وتقارير في دقائق لتسريع القرارات الطبية.</p>
        </div>
        <div class="card">
          <div class="badge">🔒 أمان البيانات</div>
          <p class="muted">توافق مع أنظمة المملكة وضوابط خصوصية صارمة.</p>
        </div>
        <div class="card">
          <div class="badge">🤝 دعم متكامل</div>
          <p class="muted">دعم فني وتدريب مستمر للكوادر الطبية.</p>
        </div>
      </div>
    </section>

    <section id="contact" class="section card">
      <h3>تواصل معنا</h3>
      <p class="muted">تواصل لبدء رحلة التحول الرقمي في منشأتك الصحية.</p>
      <div class="inline">
        <input id="contactName" placeholder="الاسم">
        <input id="contactPhone" placeholder="رقم الجوال">
      </div>
      <div class="field">
        <textarea id="contactMsg" placeholder="رسالتك"></textarea>
      </div>
      <button class="btn" id="contactBtn">إرسال</button>
      <div id="contactStatus" class="status" style="margin-top:10px">—</div>
    </section>

    <div class="footer">© 2025 Bright AI. جميع الحقوق محفوظة.</div>
  </main>

  <script>
    // ============ إعدادات عامة ============
    const UI = {
      tabs: document.querySelectorAll('.tabs button'),
      sections: {
        'image-ai': document.getElementById('image-ai'),
        'remote': document.getElementById('remote'),
        'hms': document.getElementById('hms'),
        'med-gemini': document.getElementById('med-gemini'),
      }
    };
    UI.tabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        UI.tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        for (const [key,sec] of Object.entries(UI.sections)){
          sec.hidden = key !== tab;
        }
        location.hash = tab;
      });
    });
    // استعادة تبويب من العنوان
    (()=>{
      const hash = location.hash.replace('#','');
      if (hash && UI.sections[hash]){
        document.querySelector(`.tabs button[data-tab="${hash}"]`)?.click();
      }
    })();

    // ============ أدوات مساعدة ============
    const sleep = ms => new Promise(r=>setTimeout(r, ms));

    function setStatus(el, msg, type=''){
      el.textContent = msg;
      el.classList.remove('ok','warn','err');
      if (type) el.classList.add(type);
    }

    async function readFileAsDataURL(file){
      return new Promise((res,rej)=>{
        const reader = new FileReader();
        reader.onload = ()=>res(reader.result);
        reader.onerror = rej;
        reader.readAsDataURL(file);
      });
    }

    async function readFileAsText(file){
      return new Promise((res,rej)=>{
        const reader = new FileReader();
        reader.onload = ()=>res(reader.result);
        reader.onerror = rej;
        reader.readAsText(file);
      });
    }

    function safeJson(obj){
      try { return JSON.stringify(obj, null, 2) } catch { return String(obj) }
    }

    // ============ تكامل Gemini ============
    // ملاحظة أمنية: يجب في الإنتاج تمرير الطلبات إلى خادم وسيط لحماية المفتاح.
    const GEMINI_API_KEY = "AIzaSyA4a4E59Ky528cxXbu7GWIS-huupuej8Gs";
    const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

    async function callGemini({textParts=[], inlineDataParts=[]}){
      // textParts: مصفوفة نصوص
      // inlineDataParts: [{mimeType, data}] حيث data هي base64 بدون prefix
      const contents = [{
        role: "user",
        parts: [
          ...textParts.map(t=>({text: t})),
          ...inlineDataParts.map(d=>({inlineData: d}))
        ]
      }];

      const body = { contents, generationConfig: { temperature: 0.2, top_p: 0.9, top_k: 40, max_output_tokens: 2048 } };

      const res = await fetch(`${GEMINI_URL}?key=${encodeURIComponent(GEMINI_API_KEY)}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (!res.ok){
        const errText = await res.text().catch(()=>res.statusText);
        throw new Error(`Gemini API فشل: ${res.status} - ${errText}`);
      }

      const data = await res.json();
      const text = data?.candidates?.[0]?.content?.parts?.map(p=>p.text).join("\n") || "";
      return text.trim();
    }

    function extractBase64(dataURL){
      // remove "data:<mime>;base64,"
      return dataURL.split(',')[1];
    }

    // ============ تحليل الصور الطبية ============
    const imgType = document.getElementById('imgType');
    const imgDrop = document.getElementById('imgDrop');
    const imgFile = document.getElementById('imgFile');
    const imgNotes = document.getElementById('imgNotes');
    const imgStatus = document.getElementById('imgStatus');
    const imgOutput = document.getElementById('imgOutput');
    const analyzeImageBtn = document.getElementById('analyzeImageBtn');
    const clearImageBtn = document.getElementById('clearImageBtn');

    let imgSelectedFile = null;
    // سحب وافلات
    function wireDropZone(zone, input, onFile){
      zone.addEventListener('click', ()=> input.click());
      zone.addEventListener('dragover', e=>{ e.preventDefault(); zone.classList.add('drag'); });
      zone.addEventListener('dragleave', ()=> zone.classList.remove('drag'));
      zone.addEventListener('drop', e=>{
        e.preventDefault(); zone.classList.remove('drag');
        const file = e.dataTransfer.files?.[0];
        if (file) onFile(file);
      });
      input.addEventListener('change', ()=>{
        const file = input.files?.[0];
        if (file) onFile(file);
      });
    }

    wireDropZone(imgDrop, imgFile, (file)=>{
      const ok = /\.(jpg|jpeg|png|dcm|dicom)$/i.test(file.name);
      if (!ok){ setStatus(imgStatus, 'صيغة غير مدعومة. استخدم JPG/PNG/DICOM.', 'err'); return; }
      imgSelectedFile = file;
      setStatus(imgStatus, `تم اختيار الملف: ${file.name} (${Math.round(file.size/1024)} كيلوبايت).`, 'ok');
    });

    analyzeImageBtn.addEventListener('click', async ()=>{
      if (!imgSelectedFile){
        setStatus(imgStatus, 'الرجاء رفع صورة طبية.', 'warn'); return;
      }
      setStatus(imgStatus, 'جاري تحليل الصورة بالذكاء الاصطناعي...', '');
      imgOutput.textContent = '';

      try{
        const dataUrl = await readFileAsDataURL(imgSelectedFile);
        const base = extractBase64(dataUrl);
        const mime = dataUrl.substring(dataUrl.indexOf(":")+1, dataUrl.indexOf(";"));

        // مطالبة دقيقة لضمان مخرجات مبنية على الصورة والمدخلات
        const prompt = [
`أنت نظام دعم قرار سريري. حلّل صورة ${imgType.value} المرفقة مع الأخذ بالاعتبار الملاحظات السريرية التالية (إن وجدت).`,
`أعد النتائج بصيغة منظمة:`,
`- ملخص الصورة`,
`- نتائج/علامات رئيسية`,
`- احتمالات تشخيص تفاضلي مع نسب تقريبية`,
`- توصيات متابعة/فحوصات إضافية`,
`- مستوى الخطورة (منخفض/متوسط/مرتفع)`,
`- ملاحظات تتعلق بجودة الصورة إن كان هناك قصور`,
`ملاحظات سريرية: ${imgNotes.value || 'لا يوجد'}`,
`التزم بعدم اختراع تفاصيل خارج ما يستدل من الصورة أو الملاحظات. إذا كانت جودة الصورة ضعيفة أو لا تكفي للاستدلال، صرّح بذلك بوضوح.`
        ].join('\n');

        const resultText = await callGemini({
          textParts: [prompt],
          inlineDataParts: [{ mimeType: mime, data: base }]
        });

        setStatus(imgStatus, 'تم التحليل.', 'ok');
        imgOutput.textContent = resultText;
      }catch(err){
        console.error(err);
        setStatus(imgStatus, 'حدث خطأ أثناء التحليل. تحقق من الاتصال أو المفتاح.', 'err');
        imgOutput.textContent = String(err);
      }
    });

    clearImageBtn.addEventListener('click', ()=>{
      imgSelectedFile = null;
      imgFile.value = '';
      imgNotes.value = '';
      imgOutput.textContent = '';
      setStatus(imgStatus, 'تمت إعادة الضبط. ارفع صورة جديدة.', '');
    });

    // ============ المراقبة الصحية عن بُعد ============
    const hr = document.getElementById('hr');
    const bp = document.getElementById('bp');
    const spo2 = document.getElementById('spo2');
    const glucose = document.getElementById('glucose');
    const symptoms = document.getElementById('symptoms');
    const analyzeVitalsBtn = document.getElementById('analyzeVitalsBtn');
    const clearVitalsBtn = document.getElementById('clearVitalsBtn');
    const vitalsStatus = document.getElementById('vitalsStatus');
    const vitalsOutput = document.getElementById('vitalsOutput');

    analyzeVitalsBtn.addEventListener('click', async ()=>{
      // تحقق أساسي
      if (!hr.value && !bp.value && !spo2.value && !glucose.value && !symptoms.value){
        setStatus(vitalsStatus, 'الرجاء إدخال بيانات حيوية أو أعراض.', 'warn'); return;
      }
      setStatus(vitalsStatus, 'جاري تحليل البيانات الصحية...', '');
      vitalsOutput.textContent = '';
      try{
        const payload = {
          heartRate: hr.value ? Number(hr.value) : null,
          bloodPressure: bp.value || null,
          spo2: spo2.value ? Number(spo2.value) : null,
          glucose: glucose.value ? Number(glucose.value) : null,
          symptoms: symptoms.value || ''
        };

        const prompt = [
`أنت مساعد مراقبة صحية. قيّم البيانات التالية واصنع إخراجاً مبنياً على القيم المدخلة فقط:`,
safeJson(payload),
`أعد المخرجات بصيغة:`,
`- تقييم سريع للوضع`,
`- إنذارات محتملة حسب العتبات (مثال: HR>120, SpO2<92%, BP عالي أو منخفض، سكر مرتفع/منخفض) مع ذكر السبب`,
`- توصيات فورية (منزلية/اتصال بطبيب/طوارئ)`,
`- عوامل قد تؤثر على القراءة أو تتطلب إعادة القياس`,
`- اقتراح خطة متابعة ليومين`,
`لا تختلق قيماً غير موجودة. إذا كانت صيغة الضغط غير صحيحة، اطلب تصحيحها (انقباضي/انبساطي).`
        ].join('\n');

        const resultText = await callGemini({ textParts: [prompt] });
        setStatus(vitalsStatus, 'تم التحليل.', 'ok');
        vitalsOutput.textContent = resultText;
      }catch(err){
        console.error(err);
        setStatus(vitalsStatus, 'فشل التحليل.', 'err');
        vitalsOutput.textContent = String(err);
      }
    });

    clearVitalsBtn.addEventListener('click', ()=>{
      hr.value = ''; bp.value = ''; spo2.value = ''; glucose.value = ''; symptoms.value = '';
      vitalsOutput.textContent = '';
      setStatus(vitalsStatus, 'تمت إعادة الضبط.', '');
    });

    // ============ إدارة المستشفيات ============
    const dept = document.getElementById('dept');
    const age = document.getElementById('age');
    const gender = document.getElementById('gender');
    const caseDesc = document.getElementById('caseDesc');
    const hmsAnalyzeBtn = document.getElementById('hmsAnalyzeBtn');
    const hmsClearBtn = document.getElementById('hmsClearBtn');
    const hmsStatus = document.getElementById('hmsStatus');
    const hmsOutput = document.getElementById('hmsOutput');

    hmsAnalyzeBtn.addEventListener('click', async ()=>{
      if (!caseDesc.value || !dept.value){
        setStatus(hmsStatus, 'الرجاء إدخال وصف الحالة واختيار القسم.', 'warn'); return;
      }
      setStatus(hmsStatus, 'جاري معالجة البيانات...', '');
      hmsOutput.textContent = '';
      try{
        const payload = {
          department: dept.value,
          age: age.value ? Number(age.value) : null,
          gender: gender.value || null,
          description: caseDesc.value
        };

        const prompt = [
`أنت نظام triage وإدارة تشغيل سريري للمستشفى. حلّل الحالة التالية وقدم مخرجات عملية قابلة للتنفيذ:`,
safeJson(payload),
`أخرج بصيغة:`,
`- مستوى أولوية الفرز (ESI تقريباً أو منخفض/متوسط/عاجل) مع سبب واضح`,
`- قائمة فحوصات أولية موصى بها`,
`- اقتراح مسار رعاية (تهيئة سرير، استشارة تخصصية، زمن إعادة التقييم)`,
`- تنبيهات إنذار مبكر (EWS) إن أمكن`,
`- ملاحظات لوجستية (جدولة، مخزون أدوية/أجهزة إن لزم)`,
`تمسّك بالبيانات المدخلة فقط. إذا كانت المعطيات ناقصة، اطلب الإكمال بنقاط محددة.`
        ].join('\n');

        const resultText = await callGemini({ textParts: [prompt] });
        setStatus(hmsStatus, 'تم التحليل.', 'ok');
        hmsOutput.textContent = resultText;
      }catch(err){
        console.error(err);
        setStatus(hmsStatus, 'حدث خطأ أثناء التحليل.', 'err');
        hmsOutput.textContent = String(err);
      }
    });

    hmsClearBtn.addEventListener('click', ()=>{
      age.value=''; gender.value=''; caseDesc.value='';
      hmsOutput.textContent='';
      setStatus(hmsStatus, 'تمت إعادة الضبط.', '');
    });

    // ============ Med-Gemini ============
    const mgType = document.getElementById('mgType');
    const mgQuery = document.getElementById('mgQuery');
    const mgDrop = document.getElementById('mgDrop');
    const mgFile = document.getElementById('mgFile');
    const mgAnalyzeBtn = document.getElementById('mgAnalyzeBtn');
    const mgClearBtn = document.getElementById('mgClearBtn');
    const mgStatus = document.getElementById('mgStatus');
    const mgOutput = document.getElementById('mgOutput');

    let mgSelectedFile = null;
    wireDropZone(mgDrop, mgFile, (file)=>{
      mgSelectedFile = file;
      setStatus(mgStatus, `تم رفع الملف: ${file.name}`, 'ok');
    });

    mgAnalyzeBtn.addEventListener('click', async ()=>{
      if (!mgQuery.value && !mgSelectedFile){
        setStatus(mgStatus, 'أدخل استفساراً أو ارفع ملفاً.', 'warn'); return;
      }
      setStatus(mgStatus, 'جاري التحليل باستخدام Med‑Gemini...', '');
      mgOutput.textContent = '';
      try{
        const textParts = [];
        const inlineParts = [];
        const type = mgType.value;

        const systemPrompt = [
`أنت مساعد طبي يستخدم نموذج Gemini متعدد الوسائط.`,
`نوع الطلب: ${type}.`,
`التزم بالدقة وعدم اختراع معلومات غير موجودة. إذا كان الطلب يتضمن قراراً علاجياً، أضف تحذيراً بطلب مراجعة طبيب مختص.`,
`إن كان الملف المرفوع صورة، حلّلها بما يتوافق مع النص. إن كان نصاً/تقريراً، لخّص واستخرج مؤشرات السريريّة.`
        ].join('\n');

        textParts.push(systemPrompt);

        if (mgQuery.value) textParts.push("الاستفسار/النص:\n" + mgQuery.value);

        if (mgSelectedFile){
          const dataUrl = await readFileAsDataURL(mgSelectedFile);
          const mime = dataUrl.substring(dataUrl.indexOf(":")+1, dataUrl.indexOf(";"));
          const base = extractBase64(dataUrl);
          inlineParts.push({ mimeType: mime, data: base });
        }

        const resultText = await callGemini({ textParts, inlineDataParts: inlineParts });
        setStatus(mgStatus, 'تم التحليل.', 'ok');
        mgOutput.textContent = resultText;
      }catch(err){
        console.error(err);
        setStatus(mgStatus, 'فشل التحليل.', 'err');
        mgOutput.textContent = String(err);
      }
    });

    mgClearBtn.addEventListener('click', ()=>{
      mgQuery.value=''; mgFile.value=''; mgSelectedFile=null;
      mgOutput.textContent=''; setStatus(mgStatus, 'تمت إعادة الضبط.', '');
    });

    // ============ تواصل معنا (محاكاة) ============
    document.getElementById('contactBtn').addEventListener('click', async ()=>{
      const name = document.getElementById('contactName').value.trim();
      const phone = document.getElementById('contactPhone').value.trim();
      const msg = document.getElementById('contactMsg').value.trim();
      const statusEl = document.getElementById('contactStatus');

      if (!name || !phone){
        setStatus(statusEl, 'الرجاء إدخال الاسم ورقم الجوال.', 'warn'); return;
      }
      setStatus(statusEl, 'جارٍ الإرسال...', '');
      await sleep(600);
      setStatus(statusEl, 'تم الاستلام، سنعاود الاتصال بك قريباً.', 'ok');
    });

    // ============ تحسينات إمكانية الوصول ============
    // التركيز على مناطق المخرجات بعد اكتمال التحليل
    function focusOutput(el){ el.setAttribute('tabindex','-1'); el.focus({preventScroll:false}); setTimeout(()=>el.removeAttribute('tabindex'),200); }
    [imgOutput, vitalsOutput, hmsOutput, mgOutput].forEach(el=>{
      const obs = new MutationObserver(()=>{ focusOutput(el); });
      obs.observe(el, {childList:true});
    });
  </script>
</body>
</html>